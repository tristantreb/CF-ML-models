<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of runAlignmentModelEMFcnFEV1Split</title>
  <meta name="keywords" content="runAlignmentModelEMFcnFEV1Split">
  <meta name="description" content="function to run the alignment model (EM version) given a set of run">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../index.html">Home</a> &gt;  <a href="#">Code</a> &gt; <a href="index.html">smartcare</a> &gt; runAlignmentModelEMFcnFEV1Split.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../index.html"><img alt="<" border="0" src="../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for Code/smartcare&nbsp;<img alt=">" border="0" src="../../right.png"></a></td></tr></table>-->

<h1>runAlignmentModelEMFcnFEV1Split
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function to run the alignment model (EM version) given a set of run</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function runAlignmentModelEMFcnFEV1Split(amRunParameters) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> function to run the alignment model (EM version) given a set of run
 parameters</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="amEMAlignCurves.html" class="code" title="function [meancurvesumsq, meancurvesum, meancurvecount, meancurvemean, meancurvestd, animatedmeancurvemean, profile_pre,offsets, animatedoffsets, hstg, pdoffset, overall_hstg, overall_pdoffset, animated_overall_pdoffset,isOutlier, ppts, qual, min_offset, iter] =amEMAlignCurves(amIntrCube, amHeldBackcube, amInterventions, outprior, measures, normstd, max_offset, align_wind, nmeasures, ninterventions,detaillog, sigmamethod, smoothingmethod, offsetblockingmethod, runmode, fnmodelrun)">amEMAlignCurves</a>	amEMAlignCurves - function to align measurement curves prior to intervention</li><li><a href="amEMPlotAndSaveAlignedCurves.html" class="code" title="function amEMPlotAndSaveAlignedCurves(profile_pre, meancurvemean, meancurvecount, meancurvestd, offsets,measures, max_points, min_offset, max_offset, align_wind, nmeasures, run_type, ex_start, sigmamethod, plotname, plotsubfolder)">amEMPlotAndSaveAlignedCurves</a>	amEMPlotAndSaveAlignedCurves - plots the curves pre and post alignment for</li><li><a href="amEMPlotsAndSavePredictions.html" class="code" title="function amEMPlotsAndSavePredictions(amInterventions, amIntrDatacube, measures, pdoffset,overall_pdoffset, hstg, overall_hist, meancurvemean, normmean, normstd, isOutlier,ex_start, thisinter, nmeasures, max_offset, align_wind, sigmamethod, plotname, plotsubfolder)">amEMPlotsAndSavePredictions</a>	amEMPlotsAndSavePredictions - plots measures prior to</li><li><a href="amEMPreprocessInterventions.html" class="code" title="function [amInterventions, amIntrDatacube, ninterventions] = amEMPreprocessInterventions(amInterventions,amIntrDatacube, max_offset, align_wind, ninterventions, nmeasures)">amEMPreprocessInterventions</a>	amEMPreprocessInterventions - preprocess intervention data and associated</li><li><a href="amEMPreprocessMeasures.html" class="code" title="function [amDatacube, measures, nmeasures] = amEMPreprocessMeasures(amDatacube, amInterventions, measures, demographicstable, measuresmask, align_wind, npatients, ndays, ninterventions)">amEMPreprocessMeasures</a>	amEMPreprocessMeasures - various bits of pre-processing to measures table</li><li><a href="amEMSetModelRunParametersFromTable.html" class="code" title="function [mversion, study, modelinputsmatfile, datademographicsfile, dataoutliersfile,sigmamethod, mumethod, curveaveragingmethod, smoothingmethod, offsetblockingmethod,measuresmask, runmode, randomseed, modelrun, imputationmode, confidencemode, printpredictions,max_offset, align_wind, ex_start, outprior, heldbackpct, confidencethreshold]= amEMSetModelRunParametersFromTable(amRunParameters)">amEMSetModelRunParametersFromTable</a>	amEMSetModelRunParameters - sets the various run parameters for the model</li><li><a href="amEMVisualiseAlignmentDetail.html" class="code" title="function [sorted_interventions, max_points] = amEMVisualiseAlignmentDetail(amIntrCube, amHeldBackcube, amInterventions,meancurvemean, meancurvecount, meancurvestd, overall_pdoffset, measures, min_offset, max_offset, align_wind,nmeasures, ninterventions, run_type, ex_start, curveaveragingmethod, plotname, plotsubfolder)">amEMVisualiseAlignmentDetail</a>	amEMVisualiseAlignmentDetail - creates a plot of horizontal bars showing</li><li><a href="calcConfidenceBounds.html" class="code" title="function [amInterventions] = calcConfidenceBounds(overall_pdoffset, amInterventions, offsets, min_offset, max_offset, ninterventions, confidencethreshold, confidencemode)">calcConfidenceBounds</a>	calcConfidenceBounds - calculates the lower and upper confidence bounds</li><li><a href="calcImputedProbabilities.html" class="code" title="function [amImputedCube, imputedscore] = calcImputedProbabilities(amIntrCube, amHeldBackcube,meancurvemean, meancurvestd, normstd, overall_pdoffset, max_offset, align_wind, nmeasures,ninterventions,sigmamethod, smoothingmethod, imputationmode)">calcImputedProbabilities</a>	getImputedProbabilities - gets the probabilities for the set of held back</li><li><a href="calcTotalOutliers.html" class="code" title="function [totaloutliers, totalpoints] = calcTotalOutliers(amIntrDatacube, isOutlier, amHeldBackcube, offsets, max_offset, align_wind, ninterventions)">calcTotalOutliers</a>	calcTotalOutliers - sums up the total outliers after alignment</li><li><a href="calculateMuNormalisation.html" class="code" title="function [normmean] = calculateMuNormalisation(amDatacube, amInterventions, measures, demographicstable,dataoutliers, align_wind, ninterventions, nmeasures, mumethod, study)">calculateMuNormalisation</a>	calculateMuNormalisation - - populates an array of ninterventions by</li><li><a href="calculateSigmaNormalisation.html" class="code" title="function [normstd] = calculateSigmaNormalisation(amInterventions, measures, demographicstable, ninterventions, nmeasures, sigmamethod, study)">calculateSigmaNormalisation</a>	calculateSigmaNormalisation - populates an array of ninterventions by</li><li><a href="createHeldBackcube.html" class="code" title="function [amHeldBackcube] = createHeldBackcube(amIntrDatacube, max_offset, align_wind, ninterventions, nmeasures, heldbackpct, imputationmode)">createHeldBackcube</a>	createHeldBackcube - creates an index array indicating points to be held</li><li><a href="createIntrDatacube.html" class="code" title="function [amIntrDatacube] = createIntrDatacube(amDatacube, amInterventions, align_wind, max_offset, ninterventions, nmeasures, curveaveragingmethod)">createIntrDatacube</a>	createIntrDatacube - creates the data cube for offset + alignement window</li><li><a href="createNormalisedIntrDatacube.html" class="code" title="function [amIntrNormcube] = createNormalisedIntrDatacube(amIntrDatacube, normmean, normstd, max_offset, align_wind, ninterventions, nmeasures, sigmamethod)">createNormalisedIntrDatacube</a>	createNormalisedIntrDatacube - creates the normalised data cube by</li><li><a href="setBaseDir.html" class="code" title="function [basedir] = setBaseDir()">setBaseDir</a>	setBaseDir - sets the root directory for the code, plots, data files etc</li></ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="runAlignmentModelEMScriptFEV1Split.html" class="code" title="">runAlignmentModelEMScriptFEV1Split</a>	</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function runAlignmentModelEMFcnFEV1Split(amRunParameters)</a>
0002 
0003 <span class="comment">% function to run the alignment model (EM version) given a set of run</span>
0004 <span class="comment">% parameters</span>
0005 
0006 <span class="comment">% set the various model run parameters</span>
0007 [mversion, study, modelinputsmatfile, datademographicsfile, dataoutliersfile, <span class="keyword">...</span>
0008     sigmamethod, mumethod, curveaveragingmethod, smoothingmethod, offsetblockingmethod, <span class="keyword">...</span>
0009     measuresmask, runmode, modelrun, imputationmode, confidencemode, printpredictions, <span class="keyword">...</span>
0010     max_offset, align_wind, ex_start, outprior, heldbackpct, confidencethreshold] <span class="keyword">...</span>
0011     = <a href="amEMSetModelRunParametersFromTable.html" class="code" title="function [mversion, study, modelinputsmatfile, datademographicsfile, dataoutliersfile,sigmamethod, mumethod, curveaveragingmethod, smoothingmethod, offsetblockingmethod,measuresmask, runmode, randomseed, modelrun, imputationmode, confidencemode, printpredictions,max_offset, align_wind, ex_start, outprior, heldbackpct, confidencethreshold]= amEMSetModelRunParametersFromTable(amRunParameters)">amEMSetModelRunParametersFromTable</a>(amRunParameters);
0012 
0013 fprintf(<span class="string">'Running Alignment Model %s\n'</span>, mversion);
0014 fprintf(<span class="string">'\n'</span>);
0015 
0016 <span class="comment">% load the required input data</span>
0017 tic
0018 basedir = <a href="setBaseDir.html" class="code" title="function [basedir] = setBaseDir()">setBaseDir</a>();
0019 subfolder = <span class="string">'MatlabSavedVariables'</span>;
0020 fnmodelrun = fullfile(basedir, subfolder, sprintf(<span class="string">'%s.mat'</span>,modelrun));
0021 fprintf(<span class="string">'Loading alignment model Inputs data\n'</span>);
0022 load(fullfile(basedir, subfolder, modelinputsmatfile));
0023 fprintf(<span class="string">'Loading datademographics by patient\n'</span>);
0024 load(fullfile(basedir, subfolder, datademographicsfile));
0025 fprintf(<span class="string">'Loading data outliers\n'</span>);
0026 load(fullfile(basedir, subfolder, dataoutliersfile));
0027 fprintf(<span class="string">'Loading Predictive Model Patient Measures Stats\n'</span>);
0028 load(fullfile(basedir, subfolder, <span class="string">'SCpredictivemodelinputs.mat'</span>), <span class="string">'pmPatientMeasStats'</span>);
0029 toc
0030 
0031 fprintf(<span class="string">'Creating Upper and Lower 50%% splits for FEV1\n'</span>);
0032 ntiles = 2;
0033 npmpatients = size(unique(pmPatientMeasStats.PatientNbr),1);
0034 mfev1idx  = measures.Index(ismember(measures.DisplayName, <span class="string">'LungFunction'</span>));
0035 fev1max  = pmPatientMeasStats(pmPatientMeasStats.MeasureIndex == mfev1idx, {<span class="string">'PatientNbr'</span>, <span class="string">'Study'</span>, <span class="string">'ID'</span>, <span class="string">'RobustMax'</span>});
0036 fev1max.Properties.VariableNames({<span class="string">'RobustMax'</span>}) = {<span class="string">'Max'</span>};
0037 fev1max = sortrows(fev1max, {<span class="string">'Max'</span>}, <span class="string">'ascend'</span>);
0038 fev1max.NTile(:) = 0;
0039 <span class="keyword">for</span> i = 1:npmpatients
0040     fev1max.NTile(i) = ceil((i * ntiles)/ npmpatients);
0041 <span class="keyword">end</span>
0042 fev1max = sortrows(fev1max, {<span class="string">'Study'</span>, <span class="string">'ID'</span>}, <span class="string">'ascend'</span>);
0043 amInterventionsKeep = amInterventions;
0044 ninterventionsKeep = ninterventions;
0045 
0046 <span class="keyword">for</span> t = 1:ntiles
0047     
0048     fprintf(<span class="string">'Running for FEV1 split %d\n'</span>, t);
0049     amInterventions = amInterventionsKeep(ismember(amInterventionsKeep.SmartCareID, fev1max.ID(fev1max.NTile == t)),:);
0050     ninterventions = size(amInterventions,1);
0051     
0052     tic
0053     fprintf(<span class="string">'Preparing input data\n'</span>);
0054     sversion = sprintf(<span class="string">'FEV1Split%d'</span>, t);
0055     baseplotname = sprintf(<span class="string">'%s%s_sig%d_mu%d_ca%d_sm%d_rm%d_ob%d_im%d_cm%d_mm%d_mo%d_dw%d'</span>, study, mversion, sigmamethod, mumethod, curveaveragingmethod, <span class="keyword">...</span>
0056         smoothingmethod, runmode, offsetblockingmethod, imputationmode, confidencemode, measuresmask, max_offset, align_wind);
0057     detaillog = true;
0058 
0059     <span class="comment">% pre-process measures table and associated measurement data</span>
0060     [amDatacube, measures, nmeasures] = <a href="amEMPreprocessMeasures.html" class="code" title="function [amDatacube, measures, nmeasures] = amEMPreprocessMeasures(amDatacube, amInterventions, measures, demographicstable, measuresmask, align_wind, npatients, ndays, ninterventions)">amEMPreprocessMeasures</a>(amDatacube, amInterventions, measures, <span class="keyword">...</span>
0061         demographicstable, measuresmask, align_wind, npatients, ndays, ninterventions);
0062 
0063     <span class="comment">% create cube for data window data by intervention (for each measure)</span>
0064     [amIntrDatacube] = <a href="createIntrDatacube.html" class="code" title="function [amIntrDatacube] = createIntrDatacube(amDatacube, amInterventions, align_wind, max_offset, ninterventions, nmeasures, curveaveragingmethod)">createIntrDatacube</a>(amDatacube, amInterventions, align_wind, <span class="keyword">...</span>
0065         max_offset, ninterventions, nmeasures, curveaveragingmethod);
0066 
0067     <span class="comment">% pre-process intervention table and associated measurement data</span>
0068     [amInterventions, amIntrDatacube, ninterventions] = <a href="amEMPreprocessInterventions.html" class="code" title="function [amInterventions, amIntrDatacube, ninterventions] = amEMPreprocessInterventions(amInterventions,amIntrDatacube, max_offset, align_wind, ninterventions, nmeasures)">amEMPreprocessInterventions</a>(amInterventions, <span class="keyword">...</span>
0069         amIntrDatacube, max_offset, align_wind, ninterventions, nmeasures);
0070 
0071     <span class="comment">% populate multiplicative normalisation (sigma) values based on methodology</span>
0072     <span class="comment">% selected</span>
0073     normstd = <a href="calculateSigmaNormalisation.html" class="code" title="function [normstd] = calculateSigmaNormalisation(amInterventions, measures, demographicstable, ninterventions, nmeasures, sigmamethod, study)">calculateSigmaNormalisation</a>(amInterventions, measures, demographicstable, ninterventions, nmeasures, sigmamethod);
0074 
0075     <span class="comment">% calculate additive normalisation (mu) based on methodology</span>
0076     <span class="comment">% and then create normalised data cube.</span>
0077 
0078     normmean = <a href="calculateMuNormalisation.html" class="code" title="function [normmean] = calculateMuNormalisation(amDatacube, amInterventions, measures, demographicstable,dataoutliers, align_wind, ninterventions, nmeasures, mumethod, study)">calculateMuNormalisation</a>(amDatacube, amInterventions, measures, demographicstable, <span class="keyword">...</span>
0079         dataoutliers, align_wind, ninterventions, nmeasures, mumethod);
0080 
0081     <span class="comment">% populate normalised data cube by intervention</span>
0082     [amIntrNormcube] = <a href="createNormalisedIntrDatacube.html" class="code" title="function [amIntrNormcube] = createNormalisedIntrDatacube(amIntrDatacube, normmean, normstd, max_offset, align_wind, ninterventions, nmeasures, sigmamethod)">createNormalisedIntrDatacube</a>(amIntrDatacube, normmean, normstd, <span class="keyword">...</span>
0083         max_offset, align_wind, ninterventions, nmeasures, sigmamethod);
0084 
0085     <span class="comment">% populate index array for held back points (to be used for imputation</span>
0086     [amHeldBackcube] = <a href="createHeldBackcube.html" class="code" title="function [amHeldBackcube] = createHeldBackcube(amIntrDatacube, max_offset, align_wind, ninterventions, nmeasures, heldbackpct, imputationmode)">createHeldBackcube</a>(amIntrDatacube, max_offset, align_wind, ninterventions, nmeasures, heldbackpct, imputationmode);
0087 
0088     toc
0089     fprintf(<span class="string">'\n'</span>);
0090 
0091     tic
0092     fprintf(<span class="string">'Running alignment\n'</span>);
0093     <span class="comment">% should really move this into AlignCurves function or override with value</span>
0094     <span class="comment">% loaded in there</span>
0095     <span class="keyword">for</span> i=1:size(amInterventions,1)
0096         amInterventions.Offset(i) = 0;
0097     <span class="keyword">end</span>
0098     initial_offsets = amInterventions.Offset;
0099 
0100     <span class="keyword">if</span> runmode == 6
0101         run_type = <span class="string">'Pre-selected Start'</span>;
0102     <span class="keyword">else</span>
0103         run_type = <span class="string">'Uniform Start'</span>;
0104     <span class="keyword">end</span>
0105     [meancurvesumsq, meancurvesum, meancurvecount, meancurvemean, meancurvestd, animatedmeancurvemean, profile_pre, <span class="keyword">...</span>
0106         offsets, animatedoffsets, hstg, pdoffset, overall_hist, overall_pdoffset, animated_overall_pdoffset, <span class="keyword">...</span>
0107         isOutlier, ppts, qual, min_offset, niterations] = <a href="amEMAlignCurves.html" class="code" title="function [meancurvesumsq, meancurvesum, meancurvecount, meancurvemean, meancurvestd, animatedmeancurvemean, profile_pre,offsets, animatedoffsets, hstg, pdoffset, overall_hstg, overall_pdoffset, animated_overall_pdoffset,isOutlier, ppts, qual, min_offset, iter] =amEMAlignCurves(amIntrCube, amHeldBackcube, amInterventions, outprior, measures, normstd, max_offset, align_wind, nmeasures, ninterventions,detaillog, sigmamethod, smoothingmethod, offsetblockingmethod, runmode, fnmodelrun)">amEMAlignCurves</a>(amIntrNormcube, amHeldBackcube, amInterventions, outprior, measures, <span class="keyword">...</span>
0108         normstd, max_offset, align_wind, nmeasures, ninterventions, detaillog, sigmamethod, smoothingmethod, offsetblockingmethod, runmode, fnmodelrun);
0109     fprintf(<span class="string">'%s - ErrFcn = %.8f\n'</span>, run_type, qual);
0110 
0111     <span class="comment">% save the zero offset pre-profile to unaligned_profile so all plots show a</span>
0112     <span class="comment">% consistent unaligned curve as the pre-profile.</span>
0113     unaligned_profile = profile_pre;
0114 
0115     plotname = sprintf(<span class="string">'%s_obj%.8f'</span>, baseplotname, qual);
0116 
0117     <span class="comment">% plot and save aligned curves (pre and post)</span>
0118     <a href="amEMPlotAndSaveAlignedCurves.html" class="code" title="function amEMPlotAndSaveAlignedCurves(profile_pre, meancurvemean, meancurvecount, meancurvestd, offsets,measures, max_points, min_offset, max_offset, align_wind, nmeasures, run_type, ex_start, sigmamethod, plotname, plotsubfolder)">amEMPlotAndSaveAlignedCurves</a>(unaligned_profile, meancurvemean, meancurvecount, meancurvestd, offsets, <span class="keyword">...</span>
0119         measures, 0, min_offset, max_offset, align_wind, nmeasures, run_type, 0, sigmamethod, plotname, <span class="string">'Plots'</span>);
0120 
0121     toc
0122     fprintf(<span class="string">'\n'</span>);
0123 
0124     <span class="keyword">if</span> ex_start == 0
0125         ex_start = input(<span class="string">'Look at best start and enter exacerbation start: '</span>);
0126         fprintf(<span class="string">'\n'</span>);
0127     <span class="keyword">end</span>
0128 
0129     tic
0130     run_type = <span class="string">'Best Alignment'</span>;
0131 
0132     plotname = sprintf(<span class="string">'%s_ex%d_obj%.8f'</span>, baseplotname, ex_start, qual);
0133 
0134     plotsubfolder = strcat(<span class="string">'Plots'</span>, <span class="string">'/'</span>, plotname);
0135     mkdir(strcat(basedir, plotsubfolder));
0136 
0137     [amInterventions] = <a href="calcConfidenceBounds.html" class="code" title="function [amInterventions] = calcConfidenceBounds(overall_pdoffset, amInterventions, offsets, min_offset, max_offset, ninterventions, confidencethreshold, confidencemode)">calcConfidenceBounds</a>(overall_pdoffset, amInterventions, offsets, min_offset, max_offset, ninterventions, confidencethreshold, confidencemode);
0138 
0139     [sorted_interventions, max_points] = <a href="amEMVisualiseAlignmentDetail.html" class="code" title="function [sorted_interventions, max_points] = amEMVisualiseAlignmentDetail(amIntrCube, amHeldBackcube, amInterventions,meancurvemean, meancurvecount, meancurvestd, overall_pdoffset, measures, min_offset, max_offset, align_wind,nmeasures, ninterventions, run_type, ex_start, curveaveragingmethod, plotname, plotsubfolder)">amEMVisualiseAlignmentDetail</a>(amIntrNormcube, amHeldBackcube, amInterventions, meancurvemean, <span class="keyword">...</span>
0140         meancurvecount, meancurvestd, overall_pdoffset, measures, min_offset, max_offset, align_wind, nmeasures, ninterventions, <span class="keyword">...</span>
0141         run_type, ex_start, curveaveragingmethod, plotname, plotsubfolder);
0142 
0143     <a href="amEMPlotAndSaveAlignedCurves.html" class="code" title="function amEMPlotAndSaveAlignedCurves(profile_pre, meancurvemean, meancurvecount, meancurvestd, offsets,measures, max_points, min_offset, max_offset, align_wind, nmeasures, run_type, ex_start, sigmamethod, plotname, plotsubfolder)">amEMPlotAndSaveAlignedCurves</a>(unaligned_profile, meancurvemean, meancurvecount, meancurvestd, offsets, <span class="keyword">...</span>
0144         measures, max_points, min_offset, max_offset, align_wind, nmeasures, run_type, ex_start, sigmamethod, plotname, plotsubfolder);
0145 
0146     <span class="comment">% calculate the total number of outliers and the total number of data</span>
0147     <span class="comment">% points</span>
0148     [totaloutliers, totalpoints] = <a href="calcTotalOutliers.html" class="code" title="function [totaloutliers, totalpoints] = calcTotalOutliers(amIntrDatacube, isOutlier, amHeldBackcube, offsets, max_offset, align_wind, ninterventions)">calcTotalOutliers</a>(amIntrDatacube, isOutlier, amHeldBackcube, offsets, max_offset, align_wind, ninterventions);
0149 
0150     <span class="comment">% calculate imputed probabilities for held back points</span>
0151     [amImputedCube, imputedscore] = <a href="calcImputedProbabilities.html" class="code" title="function [amImputedCube, imputedscore] = calcImputedProbabilities(amIntrCube, amHeldBackcube,meancurvemean, meancurvestd, normstd, overall_pdoffset, max_offset, align_wind, nmeasures,ninterventions,sigmamethod, smoothingmethod, imputationmode)">calcImputedProbabilities</a>(amIntrNormcube, amHeldBackcube, <span class="keyword">...</span>
0152         meancurvemean, meancurvestd, normstd, overall_pdoffset, max_offset, align_wind, <span class="keyword">...</span>
0153         nmeasures, ninterventions,sigmamethod, smoothingmethod, imputationmode);
0154 
0155     toc
0156     fprintf(<span class="string">'\n'</span>);
0157 
0158     tic
0159     basedir = <a href="setBaseDir.html" class="code" title="function [basedir] = setBaseDir()">setBaseDir</a>();
0160     subfolder = <span class="string">'MatlabSavedVariables'</span>;
0161     outputfilename = sprintf(<span class="string">'%s.mat'</span>, plotname);
0162     fprintf(<span class="string">'Saving alignment model results to file %s\n'</span>, outputfilename);
0163     fprintf(<span class="string">'\n'</span>);
0164     save(fullfile(basedir, subfolder, outputfilename), <span class="string">'amDatacube'</span>, <span class="string">'amIntrDatacube'</span>, <span class="string">'amIntrNormcube'</span>, <span class="keyword">...</span>
0165         <span class="string">'amHeldBackcube'</span>, <span class="string">'amImputedCube'</span>, <span class="string">'imputedscore'</span>, <span class="string">'amInterventions'</span>, <span class="keyword">...</span>
0166         <span class="string">'meancurvesumsq'</span>, <span class="string">'meancurvesum'</span>, <span class="string">'meancurvecount'</span>, <span class="string">'meancurvemean'</span>, <span class="string">'meancurvestd'</span>, <span class="string">'animatedmeancurvemean'</span>, <span class="keyword">...</span>
0167         <span class="string">'initial_offsets'</span>, <span class="string">'offsets'</span>, <span class="string">'animatedoffsets'</span>, <span class="string">'qual'</span>, <span class="string">'unaligned_profile'</span>, <span class="keyword">...</span>
0168         <span class="string">'hstg'</span>, <span class="string">'pdoffset'</span>, <span class="string">'overall_hist'</span>, <span class="string">'overall_pdoffset'</span>, <span class="string">'animated_overall_pdoffset'</span>, <span class="keyword">...</span>
0169         <span class="string">'ppts'</span>, <span class="string">'isOutlier'</span>, <span class="string">'outprior'</span>, <span class="string">'totaloutliers'</span>, <span class="string">'totalpoints'</span>, <span class="keyword">...</span>
0170         <span class="string">'sorted_interventions'</span>, <span class="string">'normmean'</span>, <span class="string">'normstd'</span>, <span class="string">'measures'</span>, <span class="string">'baseplotname'</span>, <span class="string">'plotname'</span>, <span class="string">'plotsubfolder'</span>, <span class="keyword">...</span>
0171         <span class="string">'study'</span>, <span class="string">'mversion'</span>, <span class="string">'min_offset'</span>, <span class="string">'max_offset'</span>, <span class="string">'align_wind'</span>, <span class="string">'ex_start'</span>, <span class="string">'confidencethreshold'</span>, <span class="keyword">...</span>
0172         <span class="string">'sigmamethod'</span>, <span class="string">'mumethod'</span>, <span class="string">'curveaveragingmethod'</span>, <span class="string">'smoothingmethod'</span>, <span class="string">'offsetblockingmethod'</span>, <span class="keyword">...</span>
0173         <span class="string">'measuresmask'</span>, <span class="string">'runmode'</span>, <span class="string">'imputationmode'</span>, <span class="string">'confidencemode'</span>, <span class="string">'printpredictions'</span>, <span class="keyword">...</span>
0174         <span class="string">'nmeasures'</span>, <span class="string">'ninterventions'</span>, <span class="string">'niterations'</span>);
0175     toc
0176     fprintf(<span class="string">'\n'</span>);
0177 
0178     <span class="keyword">if</span> printpredictions == 1
0179         tic
0180         fprintf(<span class="string">'Plotting prediction results\n'</span>);
0181         <span class="keyword">for</span> i=1:ninterventions
0182             <a href="amEMPlotsAndSavePredictions.html" class="code" title="function amEMPlotsAndSavePredictions(amInterventions, amIntrDatacube, measures, pdoffset,overall_pdoffset, hstg, overall_hist, meancurvemean, normmean, normstd, isOutlier,ex_start, thisinter, nmeasures, max_offset, align_wind, sigmamethod, plotname, plotsubfolder)">amEMPlotsAndSavePredictions</a>(amInterventions, amIntrDatacube, measures, pdoffset, <span class="keyword">...</span>
0183                 overall_pdoffset, hstg, overall_hist, meancurvemean, normmean, normstd, isOutlier, ex_start, <span class="keyword">...</span>
0184                 i, nmeasures, max_offset, align_wind, sigmamethod, plotname, plotsubfolder);
0185         <span class="keyword">end</span>
0186         toc
0187         fprintf(<span class="string">'\n'</span>);
0188     <span class="keyword">end</span>
0189     
0190 <span class="keyword">end</span>
0191 
0192 <span class="keyword">end</span>
0193 
0194 
0195 
0196 
0197</pre></div>
<hr><address>Generated on Thu 26-Aug-2021 19:28:55 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>