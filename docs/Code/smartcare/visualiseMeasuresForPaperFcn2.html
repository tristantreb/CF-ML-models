<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of visualiseMeasuresForPaperFcn2</title>
  <meta name="keywords" content="visualiseMeasuresForPaperFcn2">
  <meta name="description" content="visualiseMeasuresForPaperFcn2 - plots clinical and home measures">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../index.html">Home</a> &gt;  <a href="#">Code</a> &gt; <a href="index.html">smartcare</a> &gt; visualiseMeasuresForPaperFcn2.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../index.html"><img alt="<" border="0" src="../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for Code/smartcare&nbsp;<img alt=">" border="0" src="../../right.png"></a></td></tr></table>-->

<h1>visualiseMeasuresForPaperFcn2
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>visualiseMeasuresForPaperFcn2 - plots clinical and home measures</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function visualiseMeasuresForPaperFcn2(physdata, offset, amDatacube, cdPatient, cdAntibiotics,cdCRP, cdPFT, cdNewMeds, measures, nmeasures, ndays, study) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> visualiseMeasuresForPaperFcn2 - plots clinical and home measures</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="addCommaFormat.html" class="code" title="function [str] = addCommaFormat(num)">addCommaFormat</a>	</li><li><a href="createFigureAndPanelForPaper.html" class="code" title="function [f, p] = createFigureAndPanelForPaper(name, widthinch, heightinch)">createFigureAndPanelForPaper</a>	createFigureAndPanel - creates a figure with a ui panel and returns</li><li><a href="formatTexDisplayMeasure.html" class="code" title="function [displaynameformatted] = formatTexDisplayMeasure(displaymeasure)">formatTexDisplayMeasure</a>	formatTexDisplayMeasure - adds final formatting for displaying measure name</li><li><a href="getColourForMeasure.html" class="code" title="function [smcolour, rwcolour] = getColourForMeasure(displaymeasure)">getColourForMeasure</a>	getColorForMeasure - returns the RGB value of the colour for a given</li><li><a href="getColumnForMeasure.html" class="code" title="function [column] = getColumnForMeasure(measure)">getColumnForMeasure</a>	getColumnForMeasure - returns the column name from physdata for the</li><li><a href="getGroupedIVTreatmentDates.html" class="code" title="function [groupedtreatmentdates] = getGroupedIVTreatmentDates(abset)">getGroupedIVTreatmentDates</a>	getGroupedIVTreatmentDates - gets the start and end dates for a batch of</li><li><a href="getInvertedMeasures.html" class="code" title="function [invmeasarray] = getInvertedMeasures(study)">getInvertedMeasures</a>	getInvertedMeasures - returns an array of measure display names that need</li><li><a href="getPatientOffsets.html" class="code" title="function [patientoffsettable] = getPatientOffsets(physdata)">getPatientOffsets</a>	gets the patient offset table</li><li><a href="getUnitsForMeasure.html" class="code" title="function [units] = getUnitsForMeasure(displaymeasure)">getUnitsForMeasure</a>	getUnitsForMeasure - returns the units for a given measure</li><li><a href="plotFillArea.html" class="code" title="function plotFillArea(ax, xlower, xupper, ylower, yupper, color, facealpha, edgecolor)">plotFillArea</a>	plotFillArea - plots a shaded area on the graph (eg for confidence bounds</li><li><a href="plotFillAreaForPaper.html" class="code" title="function plotFillAreaForPaper(ax, xlower, xupper, ylower, yupper, color, facealpha, edgecolor)">plotFillAreaForPaper</a>	plotFillAreaForPaper - plots a shaded area on the graph</li><li><a href="savePlotInDir.html" class="code" title="function savePlotInDir(f, name, subfolder)">savePlotInDir</a>	savePlots - saves the figure to png and svp file types in the specified</li><li><a href="savePlotInDirAsSVG.html" class="code" title="function savePlotInDirAsSVG(f, name, subfolder)">savePlotInDirAsSVG</a>	savePlots - saves the figure to png and svp file types in the specified</li><li><a href="setBaseDir.html" class="code" title="function [basedir] = setBaseDir()">setBaseDir</a>	setBaseDir - sets the root directory for the code, plots, data files etc</li><li><a href="setMinYDisplayRangeForMeasure.html" class="code" title="function [range] = setMinYDisplayRangeForMeasure(measure)">setMinYDisplayRangeForMeasure</a>	setMinYDisplayRangeForMeasure - sets the minimum range for Y axis for</li><li><a href="setTicks.html" class="code" title="function [ticks] = setTicks(minval, maxval, nticks)">setTicks</a>	setTicks - create an array of ticks for a plot axis</li><li><a href="setYDisplayRange.html" class="code" title="function [roundedrange] = setYDisplayRange(miny, maxy, lowrangelimit)">setYDisplayRange</a>	setYDisplayRange - function to scale y axis of plots appropriately</li><li><a href="sortMeasuresForPaper.html" class="code" title="function [measures] = sortMeasuresForPaper(study, measures)">sortMeasuresForPaper</a>	sortMeasuresForPaper - returns a sorted measures table in the order to</li><li><a href="xb25mean.html" class="code" title="function y = xb25mean(x)">xb25mean</a>	xb25mean - returns the mean of the data points excluding the bottom 25% in x (sorted by</li><li><a href="xb25std.html" class="code" title="function y = xb25std(x)">xb25std</a>	xb25std - returns the std of the data points excluding the bottom 25% in x (sorted by</li><li><a href="xu25mean.html" class="code" title="function y = xu25mean(x)">xu25mean</a>	xu25mean - returns the mean of the data points excluding the upper 25% in x (sorted by</li><li><a href="xu25std.html" class="code" title="function y = xu25std(x)">xu25std</a>	xu25std - returns the std of the data points excluding the upper 25% in x (sorted by</li></ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="runPlotsForPaperEMMC.html" class="code" title="">runPlotsForPaperEMMC</a>	</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function visualiseMeasuresForPaperFcn2(physdata, offset, amDatacube, cdPatient, cdAntibiotics, </a><span class="keyword">...</span>
0002     cdCRP, cdPFT, cdNewMeds, measures, nmeasures, ndays, study)
0003 
0004 <span class="comment">% visualiseMeasuresForPaperFcn2 - plots clinical and home measures</span>
0005 
0006 invmeasarray = <a href="getInvertedMeasures.html" class="code" title="function [invmeasarray] = getInvertedMeasures(study)">getInvertedMeasures</a>(study);
0007 <span class="keyword">if</span> ismember(study,<span class="string">'SC'</span>)
0008     expat = 133;
0009 <span class="keyword">elseif</span> ismember(study, <span class="string">'CL'</span>)
0010     expat = 359;
0011 <span class="keyword">end</span>
0012 
0013 basedir = <a href="setBaseDir.html" class="code" title="function [basedir] = setBaseDir()">setBaseDir</a>();
0014 subfolder = sprintf(<span class="string">'Plots/%s'</span>, study);
0015 <span class="keyword">if</span> ~exist(strcat(basedir, subfolder), <span class="string">'dir'</span>)
0016     mkdir(strcat(basedir, subfolder));
0017 <span class="keyword">end</span>
0018 
0019 patientoffsets = <a href="getPatientOffsets.html" class="code" title="function [patientoffsettable] = getPatientOffsets(physdata)">getPatientOffsets</a>(physdata);
0020 patientlist = unique(physdata.SmartCareID);
0021 
0022 orkcolour = [0.729, 0.333, 0.827];
0023 ivacolour = [0.824, 0.412, 0.118];
0024 meancolour = [0.4, 0.4, 0.4];
0025 
0026 titlefontsize = 14;
0027 labelfontsize = 12;
0028 axisfontsize = 10;
0029 unitfontsize = 10;
0030 smallfontsize = 8;
0031 fontname = <span class="string">'Arial'</span>;
0032 
0033 widthinch = 8.25;
0034 heightinch = 11.75;
0035 name = <span class="string">''</span>;
0036 singlehght = 1/28;
0037 doublehght = singlehght * 2;
0038 triplehght = singlehght * 3;
0039 labelwidth = 0.25;
0040 plotwidth  = 0.75;
0041 
0042 ntitles = 2;
0043 nclinicalmeasures = 2;
0044 nidentifiers = 2;
0045 nlabels = nclinicalmeasures + nmeasures;
0046 
0047 typearray = [1, 6, 2, 4, 3, 5, 1, 6, 2, 4, 2, 4, 2, 4, 2, 4, 2, 4, 2, 4, 2, 4, 2, 4, 3, 5];
0048 
0049 typehght = [singlehght, doublehght, triplehght, doublehght, triplehght, singlehght];
0050 
0051 labeltext = {<span class="string">'A.'</span>; <span class="string">'Intravenous'</span>; <span class="string">'Clinical CRP'</span>; <span class="string">' '</span>; <span class="string">'Clinical FEV1'</span>; <span class="string">' '</span>; <span class="string">'B.'</span>; <span class="string">'Intravenous'</span>};
0052 
0053 [measures] = <a href="sortMeasuresForPaper.html" class="code" title="function [measures] = sortMeasuresForPaper(study, measures)">sortMeasuresForPaper</a>(study, measures);
0054 <span class="keyword">for</span> m = 1:nmeasures
0055     labeltext = [labeltext; cellstr(measures.DisplayName{m}); <span class="string">' '</span>];
0056 <span class="keyword">end</span>
0057 
0058 <span class="keyword">for</span> pat = 1:size(patientlist,1)
0059     scid       = patientlist(pat);
0060     <span class="comment">%if ismember(scid, [23, 24, 78, 133])</span>
0061     <span class="keyword">if</span> ismember(scid, expat)
0062         tic
0063 
0064         fprintf(<span class="string">'Visualising measures for patient %d\n'</span>, scid);
0065         poffset    = patientoffsets.PatientOffset(patientoffsets.SmartCareID == scid);
0066         hospital   = cdPatient.Hospital{cdPatient.ID == scid};
0067         spstart    = cdPatient.StudyDate(cdPatient.ID == scid);
0068         spstartdn  = datenum(spstart) - offset - poffset + 1;
0069         spenddn    = spstartdn + 183;
0070         <span class="comment">%hmstartdn  = min(physdata.ScaledDateNum(physdata.SmartCareID == scid));</span>
0071         hmenddn    = max(physdata.ScaledDateNum(physdata.SmartCareID == scid));
0072         <span class="keyword">if</span> size(cdNewMeds, 1) &gt; 0
0073             orkstart   = cdNewMeds.StartDate(cdNewMeds.ID == scid &amp; ismember(lower(cdNewMeds.Drugs), {<span class="string">'orkambi'</span>}));
0074             orkstartdn = datenum(orkstart) - offset - poffset + 1;
0075             ivastart   = cdNewMeds.StartDate(cdNewMeds.ID == scid &amp; ismember(lower(cdNewMeds.Drugs), {<span class="string">'ivacaftor'</span>}));
0076             ivastartdn = datenum(ivastart) - offset - poffset + 1;
0077         <span class="keyword">else</span>
0078             orkstartdn = -100;
0079             ivastartdn = -100;
0080         <span class="keyword">end</span>
0081         
0082         <span class="comment">% events</span>
0083         ivabset   = cdAntibiotics(cdAntibiotics.ID == scid &amp; ismember(cdAntibiotics.Route, {<span class="string">'IV'</span>}),:);
0084         ivabset.Startdn = datenum(ivabset.StartDate) - offset - poffset + 1;
0085         ivabset.Stopdn = datenum(ivabset.StopDate) - offset - poffset + 1;
0086         ivabgroupeddates = <a href="getGroupedIVTreatmentDates.html" class="code" title="function [groupedtreatmentdates] = getGroupedIVTreatmentDates(abset)">getGroupedIVTreatmentDates</a>(ivabset);
0087         ivabgroupeddates.Startdn = datenum(ivabgroupeddates.StartDate) - offset - poffset + 1;
0088         ivabgroupeddates.Stopdn = datenum(ivabgroupeddates.StopDate) - offset - poffset + 1;
0089 
0090         <span class="comment">%daysfrom = min(spstartdn, hmstartdn);</span>
0091         daysfrom = 0;
0092         daysto   = max(spenddn, hmenddn);
0093         xl = [daysfrom daysto];
0094 
0095         imagefilename = sprintf(<span class="string">'%s - Participant Measures - ID %d Hosp %s'</span>, study, scid, hospital);
0096         [f, p] = <a href="createFigureAndPanelForPaper.html" class="code" title="function [f, p] = createFigureAndPanelForPaper(name, widthinch, heightinch)">createFigureAndPanelForPaper</a>(name, widthinch, heightinch);
0097 
0098         currhght = 1.0;
0099         currplot = 1;
0100         <span class="keyword">for</span> i = 1:(ntitles + nclinicalmeasures + nmeasures + nlabels + nidentifiers)
0101             type = typearray(i);
0102 
0103             <span class="keyword">if</span> type == 1
0104                 <span class="comment">% title</span>
0105                 currhght = currhght - typehght(type);
0106                 sp(i) = uipanel(<span class="string">'Parent'</span>, p, <span class="keyword">...</span>
0107                                 <span class="string">'BorderType'</span>, <span class="string">'none'</span>, <span class="keyword">...</span>
0108                                 <span class="string">'BackgroundColor'</span>, <span class="string">'white'</span>, <span class="keyword">...</span>
0109                                 <span class="string">'OuterPosition'</span>, [0, currhght, 1.0, typehght(type)]);
0110                 displaytext = sprintf(<span class="string">'\\bf %s\\rm'</span>, labeltext{i});
0111                 annotation(sp(i), <span class="string">'textbox'</span>,  <span class="keyword">...</span>
0112                                 <span class="string">'String'</span>, displaytext, <span class="keyword">...</span>
0113                                 <span class="string">'Interpreter'</span>, <span class="string">'tex'</span>, <span class="keyword">...</span>
0114                                 <span class="string">'Units'</span>, <span class="string">'normalized'</span>, <span class="keyword">...</span>
0115                                 <span class="string">'Position'</span>, [0, 0, .2, 1], <span class="keyword">...</span>
0116                                 <span class="string">'HorizontalAlignment'</span>, <span class="string">'left'</span>, <span class="keyword">...</span>
0117                                 <span class="string">'VerticalAlignment'</span>, <span class="string">'middle'</span>, <span class="keyword">...</span>
0118                                 <span class="string">'LineStyle'</span>, <span class="string">'none'</span>, <span class="keyword">...</span>
0119                                 <span class="string">'FontName'</span>, fontname, <span class="keyword">...</span>
0120                                 <span class="string">'FontSize'</span>, titlefontsize);
0121             <span class="keyword">elseif</span> type == 2 || type == 3
0122                 <span class="comment">% label</span>
0123                 currhght = currhght - typehght(type);
0124                 displaytext = {<a href="formatTexDisplayMeasure.html" class="code" title="function [displaynameformatted] = formatTexDisplayMeasure(displaymeasure)">formatTexDisplayMeasure</a>(labeltext{i}); sprintf(<span class="string">'\\fontsize{%d} (%s)'</span>, unitfontsize, <a href="getUnitsForMeasure.html" class="code" title="function [units] = getUnitsForMeasure(displaymeasure)">getUnitsForMeasure</a>(labeltext{i}))};
0125                 sp(i) = uipanel(<span class="string">'Parent'</span>, p, <span class="keyword">...</span>
0126                                 <span class="string">'BorderType'</span>, <span class="string">'none'</span>, <span class="keyword">...</span>
0127                                 <span class="string">'BackgroundColor'</span>, <span class="string">'white'</span>, <span class="keyword">...</span>
0128                                 <span class="string">'OuterPosition'</span>, [0, currhght, labelwidth, typehght(type)]);
0129                 annotation(sp(i), <span class="string">'textbox'</span>,  <span class="keyword">...</span>
0130                                 <span class="string">'String'</span>, displaytext, <span class="keyword">...</span>
0131                                 <span class="string">'Interpreter'</span>, <span class="string">'tex'</span>, <span class="keyword">...</span>
0132                                 <span class="string">'Units'</span>, <span class="string">'normalized'</span>, <span class="keyword">...</span>
0133                                 <span class="string">'Position'</span>, [0, 0, 1, 1], <span class="keyword">...</span>
0134                                 <span class="string">'HorizontalAlignment'</span>, <span class="string">'center'</span>, <span class="keyword">...</span>
0135                                 <span class="string">'VerticalAlignment'</span>, <span class="string">'middle'</span>, <span class="keyword">...</span>
0136                                 <span class="string">'LineStyle'</span>, <span class="string">'none'</span>, <span class="keyword">...</span>
0137                                 <span class="string">'FontName'</span>, fontname, <span class="keyword">...</span>
0138                                 <span class="string">'FontSize'</span>, labelfontsize);
0139             <span class="keyword">elseif</span> type == 4 || type == 5
0140                 <span class="comment">% plot</span>
0141                 sp(i) = uipanel(<span class="string">'Parent'</span>, p, <span class="keyword">...</span>
0142                                 <span class="string">'BorderType'</span>, <span class="string">'none'</span>, <span class="keyword">...</span>
0143                                 <span class="string">'BackgroundColor'</span>, <span class="string">'white'</span>, <span class="keyword">...</span>
0144                                 <span class="string">'OuterPosition'</span>, [labelwidth, currhght, plotwidth, typehght(type)]);
0145 
0146                 <span class="keyword">if</span> currplot == 1
0147                     <span class="comment">% plot CRP levels</span>
0148                     pcrp = cdCRP(cdCRP.ID == scid,:);
0149                     pcrp.ScaledDateNum = datenum(pcrp.CRPDate) - offset - poffset + 1;
0150                     rangelimit = <a href="setMinYDisplayRangeForMeasure.html" class="code" title="function [range] = setMinYDisplayRangeForMeasure(measure)">setMinYDisplayRangeForMeasure</a>(<span class="string">'ClinicalCRP'</span>);
0151                     <span class="keyword">if</span> size(pcrp,1) &gt; 0
0152                         yl = <a href="setYDisplayRange.html" class="code" title="function [roundedrange] = setYDisplayRange(miny, maxy, lowrangelimit)">setYDisplayRange</a>(0, max(pcrp.NumericLevel), rangelimit);
0153                     <span class="keyword">else</span>
0154                         yl = [0, rangelimit];
0155                     <span class="keyword">end</span>
0156                     ax = subplot(1, 1, 1,<span class="string">'Parent'</span>, sp(i));
0157                     displaymeasure = <span class="string">'Clinical CRP'</span>;
0158                     ax.FontSize = axisfontsize;
0159                     ax.FontName = fontname;
0160                     ax.XTickLabel = <span class="string">''</span>;
0161                     ax.XColor = <span class="string">'white'</span>;
0162                     yticks = <a href="setTicks.html" class="code" title="function [ticks] = setTicks(minval, maxval, nticks)">setTicks</a>(yl(1), yl(2), 3);
0163                     ax.YTick = yticks;
0164                     ax.YTickLabel = <a href="addCommaFormat.html" class="code" title="function [str] = addCommaFormat(num)">addCommaFormat</a>(yticks);
0165                     ax.TickDir = <span class="string">'out'</span>;
0166                     xlim(xl);
0167                     ylim(yl);
0168                     hold on;
0169                     <span class="keyword">if</span> size(pcrp,1) &gt; 0
0170                         thiscolour = <a href="getColourForMeasure.html" class="code" title="function [smcolour, rwcolour] = getColourForMeasure(displaymeasure)">getColourForMeasure</a>(displaymeasure);
0171                         plot(ax, pcrp.ScaledDateNum,pcrp.NumericLevel, <span class="keyword">...</span>
0172                             <span class="string">'Color'</span>, thiscolour, <span class="keyword">...</span>
0173                             <span class="string">'LineStyle'</span>, <span class="string">'-'</span>, <span class="keyword">...</span>
0174                             <span class="string">'Marker'</span>, <span class="string">'o'</span>, <span class="keyword">...</span>
0175                             <span class="string">'LineWidth'</span>,1, <span class="keyword">...</span>
0176                             <span class="string">'MarkerSize'</span>,2, <span class="keyword">...</span>
0177                             <span class="string">'MarkerEdgeColor'</span>, thiscolour, <span class="keyword">...</span>
0178                             <span class="string">'MarkerFaceColor'</span>, thiscolour);
0179                     <span class="keyword">end</span>
0180                     <span class="keyword">for</span> a = 1:size(ivabgroupeddates, 1)
0181                         <a href="plotFillAreaForPaper.html" class="code" title="function plotFillAreaForPaper(ax, xlower, xupper, ylower, yupper, color, facealpha, edgecolor)">plotFillAreaForPaper</a>(ax, ivabgroupeddates.Startdn(a), ivabgroupeddates.Stopdn(a), <span class="keyword">...</span>
0182                             yl(1), yl(2), <span class="string">'red'</span>, <span class="string">'0.1'</span>, <span class="string">'none'</span>);
0183                     <span class="keyword">end</span>
0184                     <span class="keyword">if</span> size(orkstartdn, 1) ~= 0
0185                         <a href="plotFillAreaForPaper.html" class="code" title="function plotFillAreaForPaper(ax, xlower, xupper, ylower, yupper, color, facealpha, edgecolor)">plotFillAreaForPaper</a>(ax, orkstartdn, orkstartdn + 1, yl(1), yl(2), orkcolour, <span class="string">'0.2'</span>, <span class="string">'none'</span>);
0186                     <span class="keyword">end</span>
0187                     <span class="keyword">if</span> size(ivastartdn, 1) ~= 0
0188                         <a href="plotFillAreaForPaper.html" class="code" title="function plotFillAreaForPaper(ax, xlower, xupper, ylower, yupper, color, facealpha, edgecolor)">plotFillAreaForPaper</a>(ax, ivastartdn, ivastartdn + 1, yl(1), yl(2), ivacolour, <span class="string">'0.2'</span>, <span class="string">'none'</span>);
0189                     <span class="keyword">end</span>
0190                     hold off;
0191                 <span class="keyword">elseif</span> currplot == 2
0192                     <span class="comment">% plot clinical lung function</span>
0193                     ppft = cdPFT(cdPFT.ID == scid,:);
0194                     ppft.ScaledDateNum = datenum(ppft.LungFunctionDate) - offset - poffset + 1;
0195                     tablemeasure = <span class="string">'LungFunctionRecording'</span>;
0196                     m = measures.Index(ismember(measures.Name, tablemeasure));
0197                     column = <a href="getColumnForMeasure.html" class="code" title="function [column] = getColumnForMeasure(measure)">getColumnForMeasure</a>(tablemeasure);
0198                     <span class="comment">%scdata = physdata(physdata.SmartCareID == scid &amp; ismember(physdata.RecordingType, tablemeasure), :);</span>
0199                     <span class="comment">%scdata = scdata(:, {'SmartCareID','ScaledDateNum' 'Date_TimeRecorded', column});</span>
0200                     <span class="comment">%scdata.Properties.VariableNames{column} = 'Measurement';</span>
0201                     rangelimit = <a href="setMinYDisplayRangeForMeasure.html" class="code" title="function [range] = setMinYDisplayRangeForMeasure(measure)">setMinYDisplayRangeForMeasure</a>(tablemeasure);
0202                     measrow = amDatacube(scid, :, m);
0203                     
0204                     <span class="comment">%if size(scdata,1) &gt; 0</span>
0205                     <span class="keyword">if</span> sum(~isnan(measrow)) &gt; 0
0206                         <span class="comment">%ylm = setYDisplayRange(min(scdata.Measurement), max(scdata.Measurement), rangelimit);</span>
0207                         ylm = <a href="setYDisplayRange.html" class="code" title="function [roundedrange] = setYDisplayRange(miny, maxy, lowrangelimit)">setYDisplayRange</a>(min(measrow), max(measrow), rangelimit);
0208                     <span class="keyword">else</span>
0209                         ylm = [0, rangelimit];
0210                     <span class="keyword">end</span>
0211                     rangelimit = <a href="setMinYDisplayRangeForMeasure.html" class="code" title="function [range] = setMinYDisplayRangeForMeasure(measure)">setMinYDisplayRangeForMeasure</a>(<span class="string">'ClinicalFEV1'</span>);
0212                     <span class="keyword">if</span> size(ppft,1) &gt; 0
0213                         ylc = <a href="setYDisplayRange.html" class="code" title="function [roundedrange] = setYDisplayRange(miny, maxy, lowrangelimit)">setYDisplayRange</a>(min(ppft.CalcFEV1_), max(ppft.CalcFEV1_), rangelimit);
0214 
0215                     <span class="keyword">else</span>
0216                         ylc = [0, rangelimit];
0217                     <span class="keyword">end</span>
0218                     yl(1) = min(ylm(1), ylc(1));
0219                     yl(2) = max(ylm(2), ylc(2));
0220                     ax = subplot(1, 1, 1, <span class="string">'Parent'</span>, sp(i));
0221                     displaymeasure = <span class="string">'Clinical FEV1'</span>;
0222                     ax.FontSize = axisfontsize;
0223                     ax.FontName = fontname;
0224                     yticks = <a href="setTicks.html" class="code" title="function [ticks] = setTicks(minval, maxval, nticks)">setTicks</a>(yl(1), yl(2), 3);
0225                     ax.YTick = yticks;
0226                     ax.YTickLabel = <a href="addCommaFormat.html" class="code" title="function [str] = addCommaFormat(num)">addCommaFormat</a>(yticks);
0227                     ax.TickDir = <span class="string">'out'</span>;
0228                     xlabel(ax, <span class="string">'Days since start of study'</span>);
0229                     xlim(xl);
0230                     ylim(yl);
0231                     hold on;
0232                     <span class="keyword">if</span> size(ppft,1) &gt; 0
0233                         thiscolour = <a href="getColourForMeasure.html" class="code" title="function [smcolour, rwcolour] = getColourForMeasure(displaymeasure)">getColourForMeasure</a>(displaymeasure);
0234                         plot(ax, ppft.ScaledDateNum, ppft.CalcFEV1_, <span class="keyword">...</span>
0235                             <span class="string">'Color'</span>, thiscolour, <span class="keyword">...</span>
0236                             <span class="string">'LineStyle'</span>, <span class="string">'-'</span>, <span class="keyword">...</span>
0237                             <span class="string">'Marker'</span>, <span class="string">'o'</span>, <span class="keyword">...</span>
0238                             <span class="string">'LineWidth'</span>,1,<span class="keyword">...</span>
0239                             <span class="string">'MarkerSize'</span>,2,<span class="keyword">...</span>
0240                             <span class="string">'MarkerEdgeColor'</span>, thiscolour,<span class="keyword">...</span>
0241                             <span class="string">'MarkerFaceColor'</span>, thiscolour);
0242 
0243                     <span class="keyword">end</span>
0244                     <span class="keyword">for</span> a = 1:size(ivabgroupeddates, 1)
0245                         <a href="plotFillAreaForPaper.html" class="code" title="function plotFillAreaForPaper(ax, xlower, xupper, ylower, yupper, color, facealpha, edgecolor)">plotFillAreaForPaper</a>(ax, ivabgroupeddates.Startdn(a), ivabgroupeddates.Stopdn(a), <span class="keyword">...</span>
0246                             yl(1), yl(2), <span class="string">'red'</span>, <span class="string">'0.1'</span>, <span class="string">'none'</span>);
0247                     <span class="keyword">end</span>
0248                     <span class="keyword">if</span> size(orkstartdn, 1) ~= 0
0249                         <a href="plotFillAreaForPaper.html" class="code" title="function plotFillAreaForPaper(ax, xlower, xupper, ylower, yupper, color, facealpha, edgecolor)">plotFillAreaForPaper</a>(ax, orkstartdn, orkstartdn + 1, yl(1), yl(2), orkcolour, <span class="string">'0.2'</span>, <span class="string">'none'</span>);
0250                     <span class="keyword">end</span>
0251                     <span class="keyword">if</span> size(ivastartdn, 1) ~= 0
0252                         <a href="plotFillAreaForPaper.html" class="code" title="function plotFillAreaForPaper(ax, xlower, xupper, ylower, yupper, color, facealpha, edgecolor)">plotFillAreaForPaper</a>(ax, ivastartdn, ivastartdn + 1, yl(1), yl(2), ivacolour, <span class="string">'0.2'</span>, <span class="string">'none'</span>);
0253                     <span class="keyword">end</span>
0254                     hold off;
0255                 <span class="keyword">else</span>
0256                     m = currplot - nclinicalmeasures;
0257                     tablemeasure = measures.Name{m};
0258                     <span class="comment">%column = getColumnForMeasure(tablemeasure);</span>
0259                     <span class="comment">%scdata = physdata(physdata.SmartCareID == scid &amp; ismember(physdata.RecordingType, tablemeasure), :);</span>
0260                     <span class="comment">%scdata = scdata(:, {'SmartCareID','ScaledDateNum' 'Date_TimeRecorded', column});</span>
0261                     <span class="comment">%scdata.Properties.VariableNames{column} = 'Measurement';</span>
0262                     
0263                     measrow = amDatacube(scid, :, measures.Index(m));
0264                     days = 0:(ndays - 1);
0265                     
0266                     rangelimit = <a href="setMinYDisplayRangeForMeasure.html" class="code" title="function [range] = setMinYDisplayRangeForMeasure(measure)">setMinYDisplayRangeForMeasure</a>(tablemeasure);
0267                     <span class="comment">%if size(scdata, 1) &gt; 0</span>
0268                     <span class="keyword">if</span> sum(~isnan(measrow)) &gt; 0
0269                         <span class="comment">%yl = setYDisplayRange(min(scdata.Measurement), max(scdata.Measurement), rangelimit);</span>
0270                         yl = <a href="setYDisplayRange.html" class="code" title="function [roundedrange] = setYDisplayRange(miny, maxy, lowrangelimit)">setYDisplayRange</a>(min(measrow), max(measrow), rangelimit);
0271                     <span class="keyword">else</span>
0272                         yl = [0, rangelimit];
0273                     <span class="keyword">end</span>
0274 
0275                     ax = subplot(1, 1, 1,<span class="string">'Parent'</span>, sp(i));
0276                     displaymeasure = measures.DisplayName{m};
0277                     [smcolour, rwcolour] = <a href="getColourForMeasure.html" class="code" title="function [smcolour, rwcolour] = getColourForMeasure(displaymeasure)">getColourForMeasure</a>(displaymeasure);
0278                     ax.FontSize = axisfontsize;
0279                     ax.FontName = fontname;
0280                     yticks = <a href="setTicks.html" class="code" title="function [ticks] = setTicks(minval, maxval, nticks)">setTicks</a>(yl(1), yl(2), 3);
0281                     ax.YTick = yticks;
0282                     ax.YTickLabel = <a href="addCommaFormat.html" class="code" title="function [str] = addCommaFormat(num)">addCommaFormat</a>(yticks);
0283                     ax.TickDir = <span class="string">'out'</span>;
0284                     <span class="keyword">if</span> m == nmeasures
0285                         xlabel(ax, <span class="string">'Days since start of study'</span>);
0286                     <span class="keyword">else</span>
0287                         ax.XTickLabel = <span class="string">''</span>;
0288                         ax.XColor = <span class="string">'white'</span>;
0289                     <span class="keyword">end</span>
0290                     xlim(xl);
0291                     ylim(yl);
0292 
0293                     <span class="comment">%if size(scdata, 1) &gt; 0</span>
0294                     <span class="keyword">if</span> sum(~isnan(measrow)) &gt; 0
0295                         hold on;
0296                         
0297                         plot(ax, days, measrow, <span class="keyword">...</span>
0298                             <span class="string">'Color'</span>, rwcolour, <span class="keyword">...</span>
0299                             <span class="string">'LineStyle'</span>, <span class="string">'-'</span>, <span class="keyword">...</span>
0300                             <span class="string">'Marker'</span>, <span class="string">'o'</span>, <span class="keyword">...</span>
0301                             <span class="string">'LineWidth'</span>,1, <span class="keyword">...</span>
0302                             <span class="string">'MarkerSize'</span>,2, <span class="keyword">...</span>
0303                             <span class="string">'MarkerEdgeColor'</span>, rwcolour, <span class="keyword">...</span>
0304                             <span class="string">'MarkerFaceColor'</span>, rwcolour);
0305 
0306                         <span class="comment">%actx = find(~isnan(scdata.Measurement));</span>
0307                         <span class="comment">%acty = scdata.Measurement(~isnan(scdata.Measurement));</span>
0308                         <span class="comment">%fullx = (1:size(scdata.Measurement));</span>
0309                         <span class="comment">%fully = interp1(actx, acty, fullx, 'linear');</span>
0310                         <span class="comment">%fully = scdata.Measurement;</span>
0311                         
0312                         actx = find(~isnan(measrow));
0313                         acty = measrow(~isnan(measrow));
0314                         fullx = (1:size(measrow));
0315                         fully = interp1(actx, acty, fullx, <span class="string">'linear'</span>);
0316                         <span class="comment">%fully = scdata.Measurement;</span>
0317 
0318                         <span class="comment">%plot(ax, scdata.ScaledDateNum, fully, ...</span>
0319                         <span class="comment">%    'Color', rwcolour, ...</span>
0320                         <span class="comment">%    'LineStyle', '-', ...</span>
0321                         <span class="comment">%    'Marker', 'o', ...</span>
0322                         <span class="comment">%    'LineWidth',1, ...</span>
0323                         <span class="comment">%    'MarkerSize',2, ...</span>
0324                         <span class="comment">%    'MarkerEdgeColor', rwcolour, ...</span>
0325                         <span class="comment">%    'MarkerFaceColor', rwcolour);</span>
0326 
0327                         <span class="comment">%plot(ax, scdata.ScaledDateNum, movmean(fully, 4, 'omitnan'), ...</span>
0328                         <span class="comment">%    'Color', smcolour, ...</span>
0329                         <span class="comment">%    'LineStyle', '-', ...</span>
0330                         <span class="comment">%    'Marker', 'none', ...</span>
0331                         <span class="comment">%    'LineWidth', 1.5);</span>
0332 
0333                         <span class="comment">%plot(ax, days, movmean(measrow, 4, 'omitnan'), ...</span>
0334                         plot(ax, days, movmean(measrow, 4, <span class="string">'omitnan'</span>), <span class="keyword">...</span>
0335                             <span class="string">'Color'</span>, smcolour, <span class="keyword">...</span>
0336                             <span class="string">'LineStyle'</span>, <span class="string">'-'</span>, <span class="keyword">...</span>
0337                             <span class="string">'Marker'</span>, <span class="string">'none'</span>, <span class="keyword">...</span>
0338                             <span class="string">'LineWidth'</span>, 1.5);
0339 
0340                         
0341                         <span class="keyword">for</span> a = 1:size(ivabgroupeddates, 1)
0342                             <a href="plotFillAreaForPaper.html" class="code" title="function plotFillAreaForPaper(ax, xlower, xupper, ylower, yupper, color, facealpha, edgecolor)">plotFillAreaForPaper</a>(ax, ivabgroupeddates.Startdn(a), ivabgroupeddates.Stopdn(a), <span class="keyword">...</span>
0343                                 yl(1), yl(2), <span class="string">'red'</span>, <span class="string">'0.1'</span>, <span class="string">'none'</span>);
0344                         <span class="keyword">end</span>
0345                         <span class="keyword">if</span> size(orkstartdn, 1) ~= 0
0346                             <a href="plotFillAreaForPaper.html" class="code" title="function plotFillAreaForPaper(ax, xlower, xupper, ylower, yupper, color, facealpha, edgecolor)">plotFillAreaForPaper</a>(ax, orkstartdn, orkstartdn + 1, yl(1), yl(2), orkcolour, <span class="string">'0.2'</span>, <span class="string">'none'</span>);
0347                         <span class="keyword">end</span>
0348                         <span class="keyword">if</span> size(ivastartdn, 1) ~= 0
0349                             <a href="plotFillAreaForPaper.html" class="code" title="function plotFillAreaForPaper(ax, xlower, xupper, ylower, yupper, color, facealpha, edgecolor)">plotFillAreaForPaper</a>(ax, ivastartdn, ivastartdn + 1, yl(1), yl(2), ivacolour, <span class="string">'0.2'</span>, <span class="string">'none'</span>);
0350                         <span class="keyword">end</span>
0351 
0352                         <span class="comment">% use exclude upper quartile mean/std for pulse rate,</span>
0353                         <span class="comment">% otherwise use exclude bottom quartile mean/std</span>
0354                         <span class="keyword">if</span> ismember(displaymeasure, invmeasarray)
0355                             <span class="comment">%mmean = xu25mean(scdata.Measurement(~isnan(scdata.Measurement)));</span>
0356                             <span class="comment">%mstd  = xu25std(scdata.Measurement(~isnan(scdata.Measurement)));</span>
0357                             mmean = <a href="xu25mean.html" class="code" title="function y = xu25mean(x)">xu25mean</a>(measrow(~isnan(measrow)));
0358                             mstd  = <a href="xu25std.html" class="code" title="function y = xu25std(x)">xu25std</a>(measrow(~isnan(measrow)));
0359                         <span class="keyword">else</span>
0360                             <span class="comment">%mmean = xb25mean(scdata.Measurement(~isnan(scdata.Measurement)));</span>
0361                             <span class="comment">%mstd  = xb25std(scdata.Measurement(~isnan(scdata.Measurement)));</span>
0362                             mmean = <a href="xb25mean.html" class="code" title="function y = xb25mean(x)">xb25mean</a>(measrow(~isnan(measrow)));
0363                             mstd  = <a href="xb25std.html" class="code" title="function y = xb25std(x)">xb25std</a>(measrow(~isnan(measrow)));
0364                         <span class="keyword">end</span>
0365                         <a href="plotFillArea.html" class="code" title="function plotFillArea(ax, xlower, xupper, ylower, yupper, color, facealpha, edgecolor)">plotFillArea</a>(ax, xl(1), xl(2), <span class="keyword">...</span>
0366                             mmean - (0.5 * mstd), mmean + (0.5 * mstd), meancolour, <span class="string">'0.2'</span>, <span class="string">'none'</span>);
0367                         line(xl, [mmean mmean] , <span class="string">'Color'</span>, meancolour, <span class="string">'LineStyle'</span>, <span class="string">'-'</span>, <span class="string">'LineWidth'</span>, .5)
0368                         hold off;
0369                     <span class="keyword">end</span>
0370                 <span class="keyword">end</span>
0371                 currplot = currplot + 1;
0372             <span class="keyword">elseif</span> type == 6
0373                 <span class="comment">% iv and orkambi identifiers</span>
0374                 currhght = currhght - typehght(type);
0375                 sp(i) = uipanel(<span class="string">'Parent'</span>, p, <span class="keyword">...</span>
0376                                 <span class="string">'BorderType'</span>, <span class="string">'none'</span>, <span class="keyword">...</span>
0377                                 <span class="string">'BackgroundColor'</span>, <span class="string">'white'</span>, <span class="keyword">...</span>
0378                                 <span class="string">'OuterPosition'</span>, [labelwidth, currhght, plotwidth, typehght(type)]);
0379                 <span class="keyword">if</span> size(ivabgroupeddates, 1) &gt; 0
0380                     displaytext1 = sprintf(<span class="string">'\\bf %s\\rm'</span>, labeltext{i});
0381                     displaytext2 = sprintf(<span class="string">'\\bf %s\\rm'</span>, <span class="string">'antibiotics'</span>);
0382                     displaytext = {displaytext1; displaytext2};  
0383                     xposition = (((ivabgroupeddates.Startdn(1) + ivabgroupeddates.Stopdn(1)) / 2) - 22) /183;
0384                     annotation(sp(i), <span class="string">'textbox'</span>,  <span class="keyword">...</span>
0385                                     <span class="string">'String'</span>, displaytext, <span class="keyword">...</span>
0386                                     <span class="string">'Interpreter'</span>, <span class="string">'tex'</span>, <span class="keyword">...</span>
0387                                     <span class="string">'Units'</span>, <span class="string">'normalized'</span>, <span class="keyword">...</span>
0388                                     <span class="string">'Position'</span>, [xposition, 0, .2, 1], <span class="keyword">...</span>
0389                                     <span class="string">'HorizontalAlignment'</span>, <span class="string">'center'</span>, <span class="keyword">...</span>
0390                                     <span class="string">'VerticalAlignment'</span>, <span class="string">'bottom'</span>, <span class="keyword">...</span>
0391                                     <span class="string">'LineStyle'</span>, <span class="string">'none'</span>, <span class="keyword">...</span>
0392                                     <span class="string">'FontName'</span>, fontname, <span class="keyword">...</span>
0393                                     <span class="string">'FontSize'</span>, smallfontsize);
0394                 <span class="keyword">end</span>
0395                 <span class="keyword">if</span> size(orkstartdn, 1) ~= 0
0396                     displaytext1 = sprintf(<span class="string">'\\bf %s\\rm'</span>, <span class="string">'Initiation of'</span>);
0397                     displaytext2 = sprintf(<span class="string">'\\bf %s\\rm'</span>, <span class="string">'Orkambi'</span>);
0398                     displaytext = {displaytext1; displaytext2};  
0399                     xposition = (orkstartdn - 34) /183;
0400                     annotation(sp(i), <span class="string">'textbox'</span>,  <span class="keyword">...</span>
0401                                     <span class="string">'String'</span>, displaytext, <span class="keyword">...</span>
0402                                     <span class="string">'Interpreter'</span>, <span class="string">'tex'</span>, <span class="keyword">...</span>
0403                                     <span class="string">'Units'</span>, <span class="string">'normalized'</span>, <span class="keyword">...</span>
0404                                     <span class="string">'Position'</span>, [xposition, 0, .2, 1], <span class="keyword">...</span>
0405                                     <span class="string">'HorizontalAlignment'</span>, <span class="string">'center'</span>, <span class="keyword">...</span>
0406                                     <span class="string">'VerticalAlignment'</span>, <span class="string">'bottom'</span>, <span class="keyword">...</span>
0407                                     <span class="string">'LineStyle'</span>, <span class="string">'none'</span>, <span class="keyword">...</span>
0408                                     <span class="string">'FontName'</span>, fontname, <span class="keyword">...</span>
0409                                     <span class="string">'FontSize'</span>, smallfontsize);
0410                 <span class="keyword">end</span>
0411             <span class="keyword">end</span>
0412         <span class="keyword">end</span>
0413         <a href="savePlotInDir.html" class="code" title="function savePlotInDir(f, name, subfolder)">savePlotInDir</a>(f, imagefilename, subfolder);
0414         <a href="savePlotInDirAsSVG.html" class="code" title="function savePlotInDirAsSVG(f, name, subfolder)">savePlotInDirAsSVG</a>(f, imagefilename, subfolder);
0415         close(f);
0416     <span class="keyword">end</span>
0417 <span class="keyword">end</span>
0418 
0419 <span class="keyword">end</span>
0420 
0421     
0422</pre></div>
<hr><address>Generated on Tue 24-Aug-2021 16:59:35 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>