<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of amEMMCPlotSuperimposedAlignedCurvesForPaper2</title>
  <meta name="keywords" content="amEMMCPlotSuperimposedAlignedCurvesForPaper2">
  <meta name="description" content="amEMMCPlotSuperimposedAlignedCurves2 - wrapper around the">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../index.html">Home</a> &gt;  <a href="#">Code</a> &gt; <a href="index.html">smartcare</a> &gt; amEMMCPlotSuperimposedAlignedCurvesForPaper2.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../index.html"><img alt="<" border="0" src="../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for Code/smartcare&nbsp;<img alt=">" border="0" src="../../right.png"></a></td></tr></table>-->

<h1>amEMMCPlotSuperimposedAlignedCurvesForPaper2
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>amEMMCPlotSuperimposedAlignedCurves2 - wrapper around the</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function amEMMCPlotSuperimposedAlignedCurvesForPaper2(meancurvemean, meancurvecount, amIntrNormcube, amInterventions,measures, min_offset, max_offset, align_wind, nmeasures, run_type, ex_start, plotname, plotsubfolder, nlatentcurves,countthreshold, shiftmode, study, examplemode, lcexamples) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> amEMMCPlotSuperimposedAlignedCurves2 - wrapper around the
 plotSuperimposedAlignedCurves to plot for each set of latent curves</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="createFigureAndPanelForPaper.html" class="code" title="function [f, p] = createFigureAndPanelForPaper(name, widthinch, heightinch)">createFigureAndPanelForPaper</a>	createFigureAndPanel - creates a figure with a ui panel and returns</li><li><a href="formatDisplayMeasure.html" class="code" title="function [displaynameformatted] = formatDisplayMeasure(displaymeasure)">formatDisplayMeasure</a>	formatDisplayMeasure - adds final formatting for displaying measure name</li><li><a href="formatTexDisplayMeasure.html" class="code" title="function [displaynameformatted] = formatTexDisplayMeasure(displaymeasure)">formatTexDisplayMeasure</a>	formatTexDisplayMeasure - adds final formatting for displaying measure name</li><li><a href="getColourForMeasure.html" class="code" title="function [smcolour, rwcolour] = getColourForMeasure(displaymeasure)">getColourForMeasure</a>	getColorForMeasure - returns the RGB value of the colour for a given</li><li><a href="getLCSortOrder.html" class="code" title="function lcsort = getLCSortOrder(amInterventions, nlatentcurves)">getLCSortOrder</a>	getLCSortOrder - returns the latent curve sets sorted from largest</li><li><a href="getUnitsForMeasure.html" class="code" title="function [units] = getUnitsForMeasure(displaymeasure)">getUnitsForMeasure</a>	getUnitsForMeasure - returns the units for a given measure</li><li><a href="plotSuperimposedAlignedCurvesForPaper.html" class="code" title="function plotSuperimposedAlignedCurvesForPaper(ax, meancurvemean, xl, yl,tmpmeasures, tmpnmeasures, min_offset, max_offset, align_wind, ex_start, study)">plotSuperimposedAlignedCurvesForPaper</a>	plotSuperimposedAlignedCurves - plots the aligned curves for each of the</li><li><a href="plotVerticalLine.html" class="code" title="function [xl, yl] = plotVerticalLine(ax, xval, xl, yl, colour, linestyle, linewidth)">plotVerticalLine</a>	plotVerticalLine - plots a vertical line</li><li><a href="savePlotInDir.html" class="code" title="function savePlotInDir(f, name, subfolder)">savePlotInDir</a>	savePlots - saves the figure to png and svp file types in the specified</li><li><a href="savePlotInDirAsSVG.html" class="code" title="function savePlotInDirAsSVG(f, name, subfolder)">savePlotInDirAsSVG</a>	savePlots - saves the figure to png and svp file types in the specified</li><li><a href="sortMeasuresForPaper.html" class="code" title="function [measures] = sortMeasuresForPaper(study, measures)">sortMeasuresForPaper</a>	sortMeasuresForPaper - returns a sorted measures table in the order to</li></ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function amEMMCPlotSuperimposedAlignedCurvesForPaper2(meancurvemean, meancurvecount, amIntrNormcube, amInterventions, </a><span class="keyword">...</span>
0002     measures, min_offset, max_offset, align_wind, nmeasures, run_type, ex_start, plotname, plotsubfolder, nlatentcurves, <span class="keyword">...</span>
0003     countthreshold, shiftmode, study, examplemode, lcexamples)
0004 
0005 <span class="comment">% amEMMCPlotSuperimposedAlignedCurves2 - wrapper around the</span>
0006 <span class="comment">% plotSuperimposedAlignedCurves to plot for each set of latent curves</span>
0007 
0008 <span class="keyword">if</span> examplemode ~= 0
0009     <span class="keyword">if</span> (size(lcexamples, 2) ~= nlatentcurves)
0010         fprintf(<span class="string">'**** Number of latent curve examples in each set does not match the number of latent curve sets ****\n'</span>);
0011         <span class="keyword">return</span>;
0012     <span class="keyword">end</span>
0013 <span class="keyword">end</span>
0014 
0015 <span class="keyword">if</span> shiftmode == 1
0016     shifttext = <span class="string">'MeanShift'</span>;
0017 <span class="keyword">elseif</span> shiftmode == 2
0018     shifttext = <span class="string">'MaxShift'</span>;
0019 <span class="keyword">elseif</span> shiftmode == 3
0020     shifttext = <span class="string">'ExZeroShift'</span>;
0021 <span class="keyword">elseif</span> shiftmode == 4
0022     meanwindow = 7;
0023     shifttext = sprintf(<span class="string">'%ddMeanShift'</span>, meanwindow);
0024 <span class="keyword">else</span>
0025     fprintf(<span class="string">'**** Unknown shift mode ****\n'</span>);
0026 <span class="keyword">end</span>
0027 
0028 smoothwdth = 4;
0029 
0030 <span class="comment">% Preprocess the latent curve :-</span>
0031 <span class="comment">% 1) invert pulse rate</span>
0032 <span class="comment">% 2) remove points with fewer than count threshold underlying data poins</span>
0033 <span class="comment">% contributing</span>
0034 <span class="comment">% 3) apply mean smoothing</span>
0035 <span class="comment">% 4) apply a vertical shift (by the average of the points to the left of</span>
0036 <span class="comment">% ex_start)</span>
0037 <span class="keyword">for</span> n = 1:nlatentcurves
0038     pridx = measures.Index(ismember(measures.DisplayName, {<span class="string">'PulseRate'</span>}));
0039     meancurvemean(n, :, pridx) = meancurvemean(n, :, pridx) * -1;
0040     <span class="keyword">for</span> m = 1:nmeasures
0041         meancurvemean(n, meancurvecount(n, :, m) &lt; countthreshold, m) = NaN;
0042         meancurvemean(n, :, m) = movmean(meancurvemean(n, :, m), smoothwdth, <span class="string">'omitnan'</span>);
0043         <span class="keyword">if</span> shiftmode == 1
0044             vertshift = mean(meancurvemean(n, 1:(align_wind + max_offset + ex_start(n)), m));
0045         <span class="keyword">elseif</span> shiftmode == 2
0046             vertshift = max(meancurvemean(n, 1:(align_wind + max_offset + ex_start(n)), m));
0047         <span class="keyword">elseif</span> shiftmode == 3
0048             vertshift = meancurvemean(n, (align_wind + max_offset + ex_start(n)), m);
0049         <span class="keyword">elseif</span> shiftmode == 4
0050             vertshift = mean(meancurvemean(n, (align_wind + max_offset + ex_start(n) - meanwindow):(align_wind + max_offset + ex_start(n)), m));
0051         <span class="keyword">end</span>
0052         meancurvemean(n, :, m) = meancurvemean(n, :, m) - vertshift;
0053         fprintf(<span class="string">'For curve %d and measure %13s, vertical shift is %.3f\n'</span>, n, measures.DisplayName{m}, -vertshift);
0054     <span class="keyword">end</span>
0055 <span class="keyword">end</span>
0056 
0057 titlefontsize = 14;
0058 labelfontsize = 12;
0059 axisfontsize = 10;
0060 unitfontsize = 10;
0061 legendfontsize = 8;
0062 
0063 widthinch = 12;
0064 heightinch = 17;
0065 name = <span class="string">''</span>;
0066 singlehght = 1/17.25;
0067 oneandhalfhght = singlehght * 1.5;
0068 doublehght = singlehght * 2;
0069 triplehght = singlehght * 2.75;
0070 quadhght   = singlehght * 4;
0071 labelwidth = 0.2;
0072 plotwidth  = 0.8;
0073 
0074 ntitles = 2;
0075 nlcrow = 1;
0076 nmeasrows = sum(logical(measures.Mask));
0077 nlabels = nlcrow + nmeasrows;
0078 
0079 typearray = [1, 3, 6, 1, 2, 5, 2, 5, 2, 5, 2, 5, 2, 5, 4, 7];
0080 
0081 typehght = [singlehght, doublehght, triplehght, oneandhalfhght, doublehght, triplehght, oneandhalfhght];
0082 
0083 labeltext = {<span class="string">'A.'</span>; <span class="string">'Change from'</span>; <span class="string">' '</span>; <span class="string">'B.'</span>};
0084 
0085 tmpmeasures = measures(logical(measures.Mask), :);
0086 tmpnmeasures = size(tmpmeasures, 1);
0087 [tmpmeasures] = <a href="sortMeasuresForPaper.html" class="code" title="function [measures] = sortMeasuresForPaper(study, measures)">sortMeasuresForPaper</a>(study, tmpmeasures);
0088 <span class="keyword">for</span> m = 1:tmpnmeasures
0089     labeltext = [labeltext; cellstr(tmpmeasures.DisplayName{m}); <span class="string">' '</span>];
0090 <span class="keyword">end</span>
0091 
0092 plottitle   = sprintf(<span class="string">'%s - %s Superimposed %s For Paper 2'</span>, plotname, run_type, shifttext);
0093 
0094 plotsacross = nlatentcurves;
0095 plotsdown   = 1;
0096 plotpanels = 5;
0097 legendpanels = 5;
0098 <span class="keyword">if</span> nlatentcurves == 1
0099     paddingpanels = 0;
0100 <span class="keyword">else</span>
0101     paddingpanels = 1;
0102 <span class="keyword">end</span>
0103 panelsacross = ((plotpanels + paddingpanels) * nlatentcurves) + legendpanels - 1;
0104 
0105 lcsort = <a href="getLCSortOrder.html" class="code" title="function lcsort = getLCSortOrder(amInterventions, nlatentcurves)">getLCSortOrder</a>(amInterventions, nlatentcurves);
0106 
0107 [f, p] = <a href="createFigureAndPanelForPaper.html" class="code" title="function [f, p] = createFigureAndPanelForPaper(name, widthinch, heightinch)">createFigureAndPanelForPaper</a>(name, widthinch, heightinch);
0108 
0109 currhght = 1.0;
0110 currmeas = 1;
0111 <span class="keyword">for</span> i = 1:(ntitles + nlcrow + nmeasrows + nlabels)
0112     type = typearray(i);
0113     <span class="keyword">if</span> type == 1
0114         <span class="comment">% title</span>
0115         currhght = currhght - typehght(type);
0116         sp(i) = uipanel(<span class="string">'Parent'</span>, p, <span class="keyword">...</span>
0117                         <span class="string">'BorderType'</span>, <span class="string">'none'</span>, <span class="keyword">...</span>
0118                         <span class="string">'BackgroundColor'</span>, <span class="string">'white'</span>, <span class="keyword">...</span>
0119                         <span class="string">'OuterPosition'</span>, [0, currhght, 1.0, typehght(type)]);
0120         displaytext = sprintf(<span class="string">'\\bf %s\\rm'</span>, labeltext{i});            
0121         annotation(sp(i), <span class="string">'textbox'</span>,  <span class="keyword">...</span>
0122                         <span class="string">'String'</span>, displaytext, <span class="keyword">...</span>
0123                         <span class="string">'Interpreter'</span>, <span class="string">'tex'</span>, <span class="keyword">...</span>
0124                         <span class="string">'Units'</span>, <span class="string">'normalized'</span>, <span class="keyword">...</span>
0125                         <span class="string">'Position'</span>, [0, 0, 0.2, 1], <span class="keyword">...</span>
0126                         <span class="string">'HorizontalAlignment'</span>, <span class="string">'left'</span>, <span class="keyword">...</span>
0127                         <span class="string">'VerticalAlignment'</span>, <span class="string">'middle'</span>, <span class="keyword">...</span>
0128                         <span class="string">'LineStyle'</span>, <span class="string">'none'</span>, <span class="keyword">...</span>
0129                         <span class="string">'FontSize'</span>, titlefontsize);
0130         <span class="keyword">if</span> i == 1
0131             txt = <span class="string">'Group'</span>;
0132         <span class="keyword">else</span>
0133             txt = <span class="string">'Example'</span>;
0134         <span class="keyword">end</span>
0135         annotation(sp(i), <span class="string">'textbox'</span>,  <span class="keyword">...</span>
0136                         <span class="string">'String'</span>, sprintf(<span class="string">'%s 1'</span>, txt), <span class="keyword">...</span>
0137                         <span class="string">'Interpreter'</span>, <span class="string">'tex'</span>, <span class="keyword">...</span>
0138                         <span class="string">'Units'</span>, <span class="string">'normalized'</span>, <span class="keyword">...</span>
0139                         <span class="string">'Position'</span>, [0.32, 0, 0.1, 1], <span class="keyword">...</span>
0140                         <span class="string">'HorizontalAlignment'</span>, <span class="string">'center'</span>, <span class="keyword">...</span>
0141                         <span class="string">'VerticalAlignment'</span>, <span class="string">'bottom'</span>, <span class="keyword">...</span>
0142                         <span class="string">'LineStyle'</span>, <span class="string">'none'</span>, <span class="keyword">...</span>
0143                         <span class="string">'FontSize'</span>, titlefontsize);
0144         annotation(sp(i), <span class="string">'textbox'</span>,  <span class="keyword">...</span>
0145                         <span class="string">'String'</span>, sprintf(<span class="string">'%s 2'</span>, txt), <span class="keyword">...</span>
0146                         <span class="string">'Interpreter'</span>, <span class="string">'tex'</span>, <span class="keyword">...</span>
0147                         <span class="string">'Units'</span>, <span class="string">'normalized'</span>, <span class="keyword">...</span>
0148                         <span class="string">'Position'</span>, [0.5, 0, 0.1, 1], <span class="keyword">...</span>
0149                         <span class="string">'HorizontalAlignment'</span>, <span class="string">'center'</span>, <span class="keyword">...</span>
0150                         <span class="string">'VerticalAlignment'</span>, <span class="string">'bottom'</span>, <span class="keyword">...</span>
0151                         <span class="string">'LineStyle'</span>, <span class="string">'none'</span>, <span class="keyword">...</span>
0152                         <span class="string">'FontSize'</span>, titlefontsize);
0153         annotation(sp(i), <span class="string">'textbox'</span>,  <span class="keyword">...</span>
0154                         <span class="string">'String'</span>, sprintf(<span class="string">'%s 3'</span>, txt), <span class="keyword">...</span>
0155                         <span class="string">'Interpreter'</span>, <span class="string">'tex'</span>, <span class="keyword">...</span>
0156                         <span class="string">'Units'</span>, <span class="string">'normalized'</span>, <span class="keyword">...</span>
0157                         <span class="string">'Position'</span>, [0.67, 0, 0.1, 1], <span class="keyword">...</span>
0158                         <span class="string">'HorizontalAlignment'</span>, <span class="string">'center'</span>, <span class="keyword">...</span>
0159                         <span class="string">'VerticalAlignment'</span>, <span class="string">'bottom'</span>, <span class="keyword">...</span>
0160                         <span class="string">'LineStyle'</span>, <span class="string">'none'</span>, <span class="keyword">...</span>
0161                         <span class="string">'FontSize'</span>, titlefontsize);
0162     <span class="keyword">elseif</span> type == 2 || type == 3 || type == 4
0163         <span class="comment">% label</span>
0164         currhght = currhght - typehght(type);
0165         <span class="keyword">if</span> type == 3
0166             displaytext1 = sprintf(<span class="string">'\\bf %s\\rm'</span>, <span class="string">'Change from'</span>);
0167             displaytext2 = sprintf(<span class="string">'\\bf %s\\rm'</span>, <span class="string">'stable baseine'</span>);
0168             displaytext3 = sprintf(<span class="string">'\\bf %s\\rm'</span>, <span class="string">'(s.d.)'</span>);
0169             displaytext = {displaytext1; displaytext2; displaytext3};
0170         <span class="keyword">else</span>
0171             displaytext = {<a href="formatTexDisplayMeasure.html" class="code" title="function [displaynameformatted] = formatTexDisplayMeasure(displaymeasure)">formatTexDisplayMeasure</a>(labeltext{i}); sprintf(<span class="string">'\\fontsize{%d} (%s)'</span>, unitfontsize, <a href="getUnitsForMeasure.html" class="code" title="function [units] = getUnitsForMeasure(displaymeasure)">getUnitsForMeasure</a>(labeltext{i}))};
0172         <span class="keyword">end</span>
0173         sp(i) = uipanel(<span class="string">'Parent'</span>, p, <span class="keyword">...</span>
0174                         <span class="string">'BorderType'</span>, <span class="string">'none'</span>, <span class="keyword">...</span>
0175                         <span class="string">'BackgroundColor'</span>, <span class="string">'white'</span>, <span class="keyword">...</span>
0176                         <span class="string">'OuterPosition'</span>, [0, currhght, labelwidth, typehght(type)]);
0177         annotation(sp(i), <span class="string">'textbox'</span>,  <span class="keyword">...</span>
0178                         <span class="string">'String'</span>, displaytext, <span class="keyword">...</span>
0179                         <span class="string">'Interpreter'</span>, <span class="string">'tex'</span>, <span class="keyword">...</span>
0180                         <span class="string">'Units'</span>, <span class="string">'normalized'</span>, <span class="keyword">...</span>
0181                         <span class="string">'Position'</span>, [0, 0, 1, 1], <span class="keyword">...</span>
0182                         <span class="string">'HorizontalAlignment'</span>, <span class="string">'center'</span>, <span class="keyword">...</span>
0183                         <span class="string">'VerticalAlignment'</span>, <span class="string">'middle'</span>, <span class="keyword">...</span>
0184                         <span class="string">'LineStyle'</span>, <span class="string">'none'</span>, <span class="keyword">...</span>
0185                         <span class="string">'FontSize'</span>, labelfontsize);
0186     <span class="keyword">elseif</span> type == 6
0187         <span class="comment">% plot</span>
0188         sp(i) = uipanel(<span class="string">'Parent'</span>, p, <span class="keyword">...</span>
0189                         <span class="string">'BorderType'</span>, <span class="string">'none'</span>, <span class="keyword">...</span>
0190                         <span class="string">'BackgroundColor'</span>, <span class="string">'white'</span>, <span class="keyword">...</span>
0191                         <span class="string">'OuterPosition'</span>, [labelwidth, currhght, plotwidth, typehght(type)]);
0192         <span class="comment">%lcsort = getLCSortOrder(amInterventions, nlatentcurves);</span>
0193 
0194         <span class="comment">% set the plot range over all curves to ensure comparable visual scaling</span>
0195         yl = [min(min(min(meancurvemean))) <span class="keyword">...</span>
0196               max(max(max(meancurvemean)))];
0197 
0198         <span class="comment">% for each curve, plot all measures superimposed</span>
0199         <span class="keyword">for</span> n = 1:nlatentcurves
0200             lc = lcsort(n);
0201             xfrom = -1 * (align_wind + max_offset - 1 + ex_start(lc));
0202             xto   = -1 * (1 + ex_start(lc));
0203             xl = [xfrom, xto];
0204             tmp_meancurvemean  = reshape(meancurvemean(lc, :, :),  [max_offset + align_wind - 1, nmeasures]);
0205             tmp_ninterventions   = sum(amInterventions.LatentCurve == lc);
0206 
0207             <span class="keyword">if</span> tmp_ninterventions ~= 0
0208                 <span class="keyword">if</span> n == nlatentcurves
0209                     panels = (((n - 1) * (plotpanels + paddingpanels)) + 1): (((n - 1) * (plotpanels + paddingpanels)) + plotpanels + legendpanels);
0210                 <span class="keyword">else</span>
0211                     panels = (((n - 1) * (plotpanels + paddingpanels)) + 1): (((n - 1) * (plotpanels + paddingpanels)) + plotpanels);
0212                 <span class="keyword">end</span>
0213 
0214                 ax = subplot(nlcrow, panelsacross, panels, <span class="string">'Parent'</span>, sp(i));
0215                 ax.FontSize = 8;
0216                 ax.TickDir = <span class="string">'out'</span>;
0217                 <span class="comment">% comment out/uncomment out one of these depending on whether all measures</span>
0218                 <span class="comment">% wanted or just those used for alignment</span>
0219                 <span class="comment">%tmpmeasures = measures;</span>
0220                 <span class="comment">%tmpmeasures = measures(logical(measures.Mask), :);</span>
0221                 <span class="comment">%tmpnmeasures = size(tmpmeasures, 1);</span>
0222 
0223                 <span class="comment">% add legend text cell array</span>
0224                 <span class="comment">%tmp = sortMeasuresForPaper(study, tmpmeasures);</span>
0225                 <span class="comment">%legendtext = tmp.DisplayName;</span>
0226                 legendtext = tmpmeasures.DisplayName;
0227                 <span class="keyword">for</span> m = 1:tmpnmeasures
0228                     legendtext{m} = <a href="formatDisplayMeasure.html" class="code" title="function [displaynameformatted] = formatDisplayMeasure(displaymeasure)">formatDisplayMeasure</a>(legendtext{m});
0229                 <span class="keyword">end</span>
0230                 pridx = ismember(tmpmeasures.DisplayName, {<span class="string">'PulseRate'</span>});
0231                 legendtext{pridx} = sprintf(<span class="string">'%s %s'</span>, legendtext{pridx}, <span class="string">'(Inverted)'</span>);
0232 
0233                 <a href="plotSuperimposedAlignedCurvesForPaper.html" class="code" title="function plotSuperimposedAlignedCurvesForPaper(ax, meancurvemean, xl, yl,tmpmeasures, tmpnmeasures, min_offset, max_offset, align_wind, ex_start, study)">plotSuperimposedAlignedCurvesForPaper</a>(ax, tmp_meancurvemean, xl, yl, <span class="keyword">...</span>
0234                         tmpmeasures, tmpnmeasures, min_offset, max_offset, align_wind, ex_start(lc), study);
0235 
0236                 xlabel(ax, <span class="string">'Days from exacerbation start'</span>);
0237                 <span class="keyword">if</span> n ~= 1
0238                     ax.YTickLabel = <span class="string">''</span>;
0239                     ax.YColor = <span class="string">'white'</span>;
0240                 <span class="keyword">end</span>
0241                 <span class="keyword">if</span> n == nlatentcurves
0242                     legend(ax, legendtext, <span class="string">'Location'</span>, <span class="string">'eastoutside'</span>, <span class="string">'FontSize'</span>, legendfontsize);
0243                 <span class="keyword">end</span>
0244                 <span class="comment">%if nlatentcurves &gt; 1</span>
0245                 <span class="comment">%    title(ax, sprintf('Group %d (n = %d)', n, sum(amInterventions.LatentCurve == lc)), 'Units', 'normalized', 'Position', [titlexpos, titleypos, 0]);</span>
0246                 <span class="comment">%end</span>
0247             <span class="keyword">end</span>
0248         <span class="keyword">end</span>
0249     <span class="keyword">elseif</span> type == 5 || type == 7
0250         <span class="comment">% now plot examples for each latent curve set</span>
0251         sp(i) = uipanel(<span class="string">'Parent'</span>, p, <span class="keyword">...</span>
0252                         <span class="string">'BorderType'</span>, <span class="string">'none'</span>, <span class="keyword">...</span>
0253                         <span class="string">'BackgroundColor'</span>, <span class="string">'white'</span>, <span class="keyword">...</span>
0254                         <span class="string">'OuterPosition'</span>, [labelwidth, currhght, plotwidth, typehght(type)]);
0255         
0256         lcexrow = lcexamples(lcsort);
0257 
0258         <span class="keyword">for</span> n = 1:nlatentcurves
0259             a = lcexrow(n);
0260             amnormcubesingleintr = amIntrNormcube(a, :, tmpmeasures.Index(currmeas));
0261             aminterventionsrow   = amInterventions(a, :);
0262             lc = aminterventionsrow.LatentCurve;
0263             <span class="keyword">if</span> lc ~= lcsort(n)
0264                 fprintf(<span class="string">'**** Example is from a different sub-population than the latent curve ****'</span>);
0265                 <span class="keyword">return</span>;
0266             <span class="keyword">end</span>
0267             amnormcubesingleintrsmth = amnormcubesingleintr;
0268             tmp_ex_start = ex_start(lc);
0269             tmp_offset   = aminterventionsrow.Offset;
0270 
0271 
0272             <span class="comment">% Preprocess the measures :-</span>
0273             <span class="comment">% 1) invert pulse rate</span>
0274             <span class="comment">% 2) apply a vertical shift (using methodology selected)</span>
0275             pridx = find(ismember(tmpmeasures.DisplayName, {<span class="string">'PulseRate'</span>}));
0276             <span class="keyword">if</span> currmeas == pridx
0277                 amnormcubesingleintr(1, :, 1) = amnormcubesingleintr(1, :, 1) * -1;
0278             <span class="keyword">end</span>
0279             actx = find(~isnan(amnormcubesingleintr(1, :, 1)));
0280             acty = amnormcubesingleintr(1, ~isnan(amnormcubesingleintr(1, :, 1)), 1);
0281             fullx = (1:size(amnormcubesingleintr(1, :, 1), 2));
0282             amnormcubesingleintr(1, :, 1) = interp1(actx, acty, fullx, <span class="string">'linear'</span>);
0283             amnormcubesingleintrsmth(1, :, 1) = movmean(amnormcubesingleintr(1, :, 1), smoothwdth, <span class="string">'omitnan'</span>);
0284 
0285             <span class="keyword">if</span> all(isnan(amnormcubesingleintrsmth(1, 1:(align_wind + max_offset + tmp_ex_start + tmp_offset), 1)))
0286                     vertshift = 0;
0287             <span class="keyword">else</span>
0288                 <span class="keyword">if</span> shiftmode == 1
0289                     vertshift = mean(amnormcubesingleintrsmth(1, 1:(align_wind + max_offset + tmp_ex_start + tmp_offset), 1), <span class="string">'omitnan'</span>);
0290                 <span class="keyword">elseif</span> shiftmode == 2
0291                     vertshift = max(amnormcubesingleintrsmth(1, 1:(align_wind + max_offset + tmp_ex_start + tmp_offset), 1), <span class="string">'omitnan'</span>);
0292                 <span class="keyword">elseif</span> shiftmode == 3
0293                     vertshift = amnormcubesingleintrsmth(1, find(~isnan(amnormcubesingleintrsmth(1, 1:(align_wind + max_offset + tmp_ex_start + tmp_offset), 1)), 1, <span class="string">'last'</span>), 1);
0294                 <span class="keyword">elseif</span> shiftmode == 4
0295                     vertshift = mean(amnormcubesingleintrsmth(1, (align_wind + max_offset + tmp_ex_start + tmp_offset - meanwindow):(align_wind + max_offset + tmp_ex_start + tmp_offset), 1), <span class="string">'omitnan'</span>);
0296                 <span class="keyword">end</span>
0297             <span class="keyword">end</span>
0298             amnormcubesingleintr(1, :, 1) = amnormcubesingleintr(1, :, 1) - vertshift;
0299             amnormcubesingleintrsmth(1, :, 1) = amnormcubesingleintrsmth(1, :, 1) - vertshift;
0300             fprintf(<span class="string">'For intervention %3d, measure %13s, vertical shift is %.3f\n'</span>, a, tmpmeasures.DisplayName{1}, -vertshift);
0301 
0302             xfrom = -1 * (align_wind + max_offset - 1 + ex_start(lc));
0303             xto   = -1 * (1 + ex_start(lc));
0304             xl = [xfrom, xto];
0305 
0306             <span class="comment">%yl = [min(min(amnormcubesingleintrsmth(1, :, logical(measures.Mask)))) ...</span>
0307             <span class="comment">%      max(max(amnormcubesingleintrsmth(1, :, logical(measures.Mask))))];</span>
0308             yl = [-4, 2.75];
0309             
0310             panels = (((n - 1) * (plotpanels + paddingpanels)) + 1): (((n - 1) * (plotpanels + paddingpanels)) + plotpanels);
0311 
0312             <span class="comment">% plot all measures superimposed</span>
0313             ax = subplot(plotsdown, panelsacross, panels, <span class="string">'Parent'</span>, sp(i));
0314             ax.FontSize = 8;
0315 
0316             hold on;
0317             [smcolour, rwcolour] = <a href="getColourForMeasure.html" class="code" title="function [smcolour, rwcolour] = getColourForMeasure(displaymeasure)">getColourForMeasure</a>(tmpmeasures.DisplayName{currmeas});
0318             lstyle = <span class="string">'-'</span>;
0319             lwidth = 1.5;
0320             days = xl(1):xl(2);
0321             dfrom = 1; 
0322             dto   = max_offset + align_wind - 1 - tmp_offset;
0323             mfrom = 1 + tmp_offset; 
0324             mto   = max_offset + align_wind - 1;
0325             plot(ax, days(dfrom:dto), amnormcubesingleintr(1, mfrom:mto, 1), <span class="keyword">...</span>
0326                 <span class="string">'Color'</span>, rwcolour, <span class="keyword">...</span>
0327                 <span class="string">'LineStyle'</span>, <span class="string">':'</span>, <span class="keyword">...</span>
0328                 <span class="string">'Marker'</span>, <span class="string">'o'</span>, <span class="keyword">...</span>
0329                 <span class="string">'LineWidth'</span>,1, <span class="keyword">...</span>
0330                 <span class="string">'MarkerSize'</span>,2, <span class="keyword">...</span>
0331                 <span class="string">'MarkerEdgeColor'</span>, rwcolour, <span class="keyword">...</span>
0332                 <span class="string">'MarkerFaceColor'</span>, rwcolour);
0333 
0334             plot(ax, days(dfrom:dto), amnormcubesingleintrsmth(1, mfrom:mto, 1), <span class="keyword">...</span>
0335                 <span class="string">'Color'</span>, smcolour, <span class="keyword">...</span>
0336                 <span class="string">'LineStyle'</span>, lstyle, <span class="keyword">...</span>
0337                 <span class="string">'Marker'</span>, <span class="string">'none'</span>, <span class="keyword">...</span>
0338                 <span class="string">'LineWidth'</span>, lwidth);
0339             <span class="keyword">if</span> tmp_ex_start ~= 0
0340                 [~, ~] = <a href="plotVerticalLine.html" class="code" title="function [xl, yl] = plotVerticalLine(ax, xval, xl, yl, colour, linestyle, linewidth)">plotVerticalLine</a>(ax, 0, xl, yl, <span class="string">'black'</span>, <span class="string">'-'</span>, 0.5); <span class="comment">% plot ex_start</span>
0341             <span class="keyword">end</span>
0342 
0343             <span class="comment">%plotSuperimposedMeasuresB4IntrForPaper(ax, tmp_amnormcubesingleintr, tmp_amnormcubesingleintrsmth, xl, yl, ...</span>
0344             <span class="comment">%        tmpmeasures, tmpnmeasures, max_offset, align_wind, tmp_offset, tmp_ex_start, study);</span>
0345             hold off;
0346             <span class="keyword">if</span> currmeas == tmpnmeasures
0347                 xlabel(ax, <span class="string">'Days from exacerbation start'</span>);
0348             <span class="keyword">else</span>
0349                 ax.XTickLabel = <span class="string">''</span>;
0350                 ax.XColor = <span class="string">'white'</span>;
0351             <span class="keyword">end</span>
0352             ylabelposmult = 1.125;
0353             <span class="comment">%if n == 1</span>
0354             <span class="comment">%    ylabeltext = 'Change from stable baseline (s.d.)';</span>
0355             <span class="comment">%    ylabel(ax, ylabeltext, 'Position',[(xl(1) - 12) (yl(1) + (yl(2) - yl(1) * ylabelposmult))], 'VerticalAlignment', 'top', 'HorizontalAlignment', 'left', 'Rotation', 0);</span>
0356             <span class="comment">%else</span>
0357             <span class="keyword">if</span> n ~= 1
0358                 ax.YTickLabel = <span class="string">''</span>;
0359                 ax.YColor = <span class="string">'white'</span>;
0360             <span class="keyword">end</span>
0361         <span class="keyword">end</span>
0362         currmeas = currmeas + 1;
0363     <span class="keyword">end</span>
0364 <span class="keyword">end</span>
0365 
0366 <span class="comment">% save plot</span>
0367 <a href="savePlotInDir.html" class="code" title="function savePlotInDir(f, name, subfolder)">savePlotInDir</a>(f, plottitle, plotsubfolder);
0368 <a href="savePlotInDirAsSVG.html" class="code" title="function savePlotInDirAsSVG(f, name, subfolder)">savePlotInDirAsSVG</a>(f, plottitle, plotsubfolder);
0369 close(f);
0370 
0371 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Thu 26-Aug-2021 19:28:55 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>